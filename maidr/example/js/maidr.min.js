class Constants{svg_container_id="svg-container";braille_container_id="braille-div";braille_input_id="braille-input";info_id="info";announcement_container_id="announcements";end_chime_id="end_chime";container_id="container";project_id="maidr";review_id_container="review_container";review_id="review";reviewSaveSpot;reviewSaveBrailleMode;constructor(){this.svg_container=document.getElementById(this.svg_container_id),this.svg=document.querySelector("#"+this.svg_container_id+" > svg"),this.brailleContainer=document.getElementById(this.braille_container_id),this.brailleInput=document.getElementById(this.braille_input_id),this.infoDiv=document.getElementById(this.info_id),this.announceContainer=document.getElementById(this.announcement_container_id),this.nonMenuFocus=this.svg,this.endChime=document.getElementById(this.end_chime_id)}textMode="verbose";brailleMode="on";sonifMode="on";reviewMode="off";layer=2;minX=0;maxX=0;minY=0;maxY=0;plotId="";chartType="";navigation=1;MAX_FREQUENCY=1e3;MIN_FREQUENCY=200;NULL_FREQUENCY=100;MAX_SPEED=2e3;MIN_SPEED=50;INTERVAL=50;vol=.5;MAX_VOL=30;autoPlayRate=250;colorSelected="#03C809";brailleDisplayLength=40;showRect=1;hasRect=1;duration=.3;outlierDuration=.06;autoPlayOutlierRate=50;autoPlayPointsRate=30;colorUnselected="#595959";isTracking=1;visualBraille=!1;showDisplay=1;showDisplayInBraille=1;showDisplayInAutoplay=0;outlierInterval=null;isMac=navigator.userAgent.toLowerCase().includes("mac");control=this.isMac?"Cmd":"Ctrl";alt=this.isMac?"option":"Alt";home=this.isMac?"fn + Left arrow":"Home";end=this.isMac?"fn + Right arrow":"End";keypressInterval=2e3;debugLevel=3;canPlayEndChime=!1;manualData=!0;PrepChartHelperComponents(){document.getElementById(this.info_id)||document.getElementById(this.svg_container_id)&&document.getElementById(this.svg_container_id).insertAdjacentHTML("afterend",'<br>\n<div id="info" aria-live="assertive" aria-atomic="true">\n<p id="x"></p>\n<p id="y"></p>\n</div>\n'),document.getElementById(this.announcement_container_id)||document.getElementById(this.info_id)&&document.getElementById(this.info_id).insertAdjacentHTML("afterend",'<div id="announcements" aria-live="assertive" aria-atomic="true">\n</div>\n'),document.getElementById(this.braille_container_id)||document.getElementById(this.container_id)&&document.getElementById(this.container_id).insertAdjacentHTML("afterbegin",'<div id="braille-div">\n<input id="braille-input" class="braille-input hidden" type="text" />\n</div>\n'),document.getElementById(this.svg_container_id)&&(document.querySelector("#"+this.svg_container_id+" > svg").setAttribute("role","application"),document.querySelector("#"+this.svg_container_id+" > svg").setAttribute("tabindex","0")),document.getElementById(this.end_chime_id)||document.getElementById(this.info_id)&&document.getElementById(this.info_id).insertAdjacentHTML("afterend",'<div class="hidden"> <audio src="../src/terminalBell.mp3" id="end_chime"></audio> </div>')}KillAutoplay(){this.autoplayId&&(clearInterval(this.autoplayId),this.autoplayId=null)}KillSepPlay(){this.sepPlayId&&(clearInterval(this.sepPlayId),this.sepPlayId=null)}SpeedUp(){constants.autoPlayRate-this.INTERVAL>this.MIN_SPEED&&(constants.autoPlayRate-=this.INTERVAL)}SpeedDown(){constants.autoPlayRate+this.INTERVAL<=this.MAX_SPEED&&(constants.autoPlayRate+=this.INTERVAL)}}class Resources{constructor(){}language="en";knowledgeLevel="basic";strings={en:{basic:{upper_outlier:"Upper Outlier",lower_outlier:"Lower Outlier",min:"Minimum",max:"Maximum",25:"25%",50:"50%",75:"75%",son_on:"Sonification on",son_off:"Sonification off",son_des:"Sonification descrete",son_comp:"Sonification compare",son_ch:"Sonification chord",son_sep:"Sonification separate",son_same:"Sonification combined",empty:"Empty"}}};GetString(t){return this.strings[this.language][this.knowledgeLevel][t]}}class Menu{constructor(){this.CreateMenu(),this.LoadDataFromLocalStorage()}menuHtml=`\n        <div id="menu" class="modal hidden" role="dialog" tabindex="-1">\n            <div class="modal-dialog" role="document" tabindex="0">\n                <div class="modal-content">\n                    <div class="modal-header">\n                        <h4 class="modal-title">Menu</h4>\n                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n                            <span aria-hidden="true">&times;</span>\n                        </button>\n                    </div>\n                    <div class="modal-body">\n                        <div>\n                            <h5 class="modal-title">Keyboard Shortcuts</h5>\n                            <table>\n                                <caption class="sr-only">Keyboard Shortcuts</caption>\n                                <thead>\n                                    <tr>\n                                        <th scope="col">Function</th>\n                                        <th scope="col">Key</th>\n                                    </tr>\n                                </thead>\n                                <tbody>\n                                    <tr>\n                                        <td>Move around plot</td>\n                                        <td>Arrow keys</td>\n                                    </tr>\n                                    <tr>\n                                        <td>Go to the very left right up down</td>\n                                        <td>${constants.control} + Arrow key</td>\n                                    </tr>\n                                    <tr>\n                                        <td>Select the first element</td>\n                                        <td>${constants.control} + ${constants.home}</td>\n                                    </tr>\n                                    <tr>\n                                        <td>Select the last element</td>\n                                        <td>${constants.control} + ${constants.end}</td>\n                                    </tr>\n                                    <tr>\n                                        <td>Toggle Braille Mode</td>\n                                        <td>b</td>\n                                    </tr>\n                                    <tr>\n                                        <td>Toggle Sonification Mode</td>\n                                        <td>s</td>\n                                    </tr>\n                                    <tr>\n                                        <td>Toggle Text Mode</td>\n                                        <td>t</td>\n                                    </tr>\n                                    <tr>\n                                        <td>Repeat current sound</td>\n                                        <td>Space</td>\n                                    </tr>\n                                    <tr>\n                                        <td>Auto-play outward in direction of arrow</td>\n                                        <td>${constants.control} + Shift + Arrow key</td>\n                                    </tr>\n                                    <tr>\n                                        <td>Auto-play inward in direction of arrow</td>\n                                        <td>${constants.alt} + Shift + Arrow key</td>\n                                    </tr>\n                                    <tr>\n                                        <td>Stop Auto-play</td>\n                                        <td>${constants.control}</td>\n                                    </tr>\n                                    <tr>\n                                        <td>Auto-play speed up</td>\n                                        <td>Period</td>\n                                    </tr>\n                                    <tr>\n                                        <td>Auto-play speed down</td>\n                                        <td>Comma</td>\n                                    </tr>\n                                </tbody>\n                            </table>\n                        </div>\n\n                        <div>\n                            <h5 class="modal-title">Settings</h5>\n                            <p><input type="range" id="vol" name="vol" min="0" max="1" step=".05"><label for="vol">Volume</label></p>\n                            \x3c!-- <p><input type="checkbox" id="show_rect" name="show_rect"><label for="show_rect">Show Outline</label></p> //--\x3e\n                            <p><input type="number" min="4" max="2000" step="1" id="braille_display_length" name="braille_display_length"><label for="braille_display_length">Braille Display Size</label></p>\n                            <p><input type="number" min="50" max="2000" step="50" id="autoplay_rate" name="autoplay_rate"><label for="autoplay_rate">Autoplay Rate</label></p>\n                            <p><input type="color" id="color_selected" name="color_selected"><label for="color_selected">Outline Color</label></p>\n                            <p><input type="number" min="10" max="2000" step="10" id="min_freq" name="min_freq"><label for="min_freq">Min Frequency (Hz)</label></p>\n                            <p><input type="number" min="20" max="2010" step="10" id="max_freq" name="max_freq"><label for="max_freq">Max Frequency (Hz)</label></p>\n                            <p><input type="number" min="500" max="5000" step="500" id="keypress_interval" name="keypress_interval"><label for="keypress_interval">Keypress Interval (ms)</label></p>\n                        </div>\n                    </div>\n                    <div class="modal-footer">\n                        <button type="button" id="save_and_close_menu">Save and close</button>\n                        <button type="button" id="close_menu">Close</button>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div id="modal_backdrop" class="modal-backdrop hidden"></div>\n        `;CreateMenu(){document.querySelector("body").insertAdjacentHTML("beforeend",this.menuHtml)}Toggle(t){void 0===t&&(t=!!document.getElementById("menu").classList.contains("hidden")),t?(this.PopulateData(),document.getElementById("menu").classList.remove("hidden"),document.getElementById("modal_backdrop").classList.remove("hidden"),document.querySelector("#menu .close").focus()):(document.getElementById("menu").classList.add("hidden"),document.getElementById("modal_backdrop").classList.add("hidden"),constants.nonMenuFocus.focus())}PopulateData(){document.getElementById("vol").value=constants.vol,document.getElementById("autoplay_rate").value=constants.autoPlayRate,document.getElementById("braille_display_length").value=constants.brailleDisplayLength,document.getElementById("color_selected").value=constants.colorSelected,document.getElementById("min_freq").value=constants.MIN_FREQUENCY,document.getElementById("max_freq").value=constants.MAX_FREQUENCY,document.getElementById("keypress_interval").value=constants.keypressInterval}SaveData(){constants.vol=document.getElementById("vol").value,constants.autoPlayRate=document.getElementById("autoplay_rate").value,constants.brailleDisplayLength=document.getElementById("braille_display_length").value,constants.colorSelected=document.getElementById("color_selected").value,constants.MIN_FREQUENCY=document.getElementById("min_freq").value,constants.MAX_FREQUENCY=document.getElementById("max_freq").value,constants.keypressInterval=document.getElementById("keypress_interval").value}SaveDataToLocalStorage(){let t={};t.vol=constants.vol,t.autoPlayRate=constants.autoPlayRate,t.brailleDisplayLength=constants.brailleDisplayLength,t.colorSelected=constants.colorSelected,t.MIN_FREQUENCY=constants.MIN_FREQUENCY,t.MAX_FREQUENCY=constants.MAX_FREQUENCY,t.keypressInterval=constants.keypressInterval,localStorage.setItem("settings_data",JSON.stringify(t))}LoadDataFromLocalStorage(){let t=JSON.parse(localStorage.getItem("settings_data"));t&&(constants.vol=t.vol,constants.autoPlayRate=t.autoPlayRate,constants.brailleDisplayLength=t.brailleDisplayLength,constants.colorSelected=t.colorSelected,constants.MIN_FREQUENCY=t.MIN_FREQUENCY,constants.MAX_FREQUENCY=t.MAX_FREQUENCY,constants.keypressInterval=t.keypressInterval)}}class Position{constructor(t,e,n=-1){this.x=t,this.y=e,this.z=n}}class Helper{static containsObject(t,e){for(let n=0;n<e.length;n++)if(e[n]===t)return!0;return!1}}class Tracker{constructor(){this.DataSetup()}DataSetup(){if(this.GetTrackerData());else{let t={};t.userAgent=Object.assign(navigator.userAgent),t.vendor=Object.assign(navigator.vendor),t.language=Object.assign(navigator.language),t.platform=Object.assign(navigator.platform),t.events=[],this.SaveTrackerData(t)}}DownloadTrackerData(){let t=document.createElement("a"),e=this.GetTrackerData(),n=new Blob([JSON.stringify(e)],{type:"text/plain"});t.href=URL.createObjectURL(n),t.download="tracking.json",t.click()}SaveTrackerData(t){localStorage.setItem(constants.project_id,JSON.stringify(t))}GetTrackerData(){return JSON.parse(localStorage.getItem(constants.project_id))}Delete(){localStorage.removeItem(constants.project_id),this.data=null,constants.debugLevel>0&&console.log("tracking data cleared"),this.DataSetup()}LogEvent(t){let e={};if(e.timestamp=Object.assign(t.timeStamp),e.time=Date().toString(),e.key=Object.assign(t.key),e.which=Object.assign(t.which),e.altKey=Object.assign(t.altKey),e.ctrlKey=Object.assign(t.ctrlKey),e.shiftKey=Object.assign(t.shiftKey),t.path&&(e.focus=Object.assign(t.path[0].tagName)),this.isUndefinedOrNull(constants.position)||(e.position=Object.assign(constants.position)),this.isUndefinedOrNull(constants.minX)||(e.min_x=Object.assign(constants.minX)),this.isUndefinedOrNull(constants.maxX)||(e.max_x=Object.assign(constants.maxX)),this.isUndefinedOrNull(constants.minY)||(e.min_y=Object.assign(constants.minY)),this.isUndefinedOrNull(constants.MAX_FREQUENCY)||(e.max_frequency=Object.assign(constants.MAX_FREQUENCY)),this.isUndefinedOrNull(constants.MIN_FREQUENCY)||(e.min_frequency=Object.assign(constants.MIN_FREQUENCY)),this.isUndefinedOrNull(constants.NULL_FREQUENCY)||(e.null_frequency=Object.assign(constants.NULL_FREQUENCY)),this.isUndefinedOrNull(constants.MAX_SPEED)||(e.max_speed=Object.assign(constants.MAX_SPEED)),this.isUndefinedOrNull(constants.MIN_SPEED)||(e.min_speed=Object.assign(constants.MIN_SPEED)),this.isUndefinedOrNull(constants.INTERVAL)||(e.interval=Object.assign(constants.INTERVAL)),this.isUndefinedOrNull(constants.vol)||(e.volume=Object.assign(constants.vol)),this.isUndefinedOrNull(constants.autoPlayRate)||(e.autoplay_rate=Object.assign(constants.autoPlayRate)),this.isUndefinedOrNull(constants.colorSelected)||(e.color=Object.assign(constants.colorSelected)),this.isUndefinedOrNull(constants.brailleDisplayLength)||(e.braille_display_length=Object.assign(constants.brailleDisplayLength)),this.isUndefinedOrNull(constants.duration)||(e.tone_duration=Object.assign(constants.duration)),this.isUndefinedOrNull(constants.autoPlayOutlierRate)||(e.autoplay_outlier_rate=Object.assign(constants.autoPlayOutlierRate)),this.isUndefinedOrNull(constants.autoPlayPointsRate)||(e.autoplay_points_rate=Object.assign(constants.autoPlayPointsRate)),this.isUndefinedOrNull(constants.textMode)||(e.text_mode=Object.assign(constants.textMode)),this.isUndefinedOrNull(constants.sonifMode)||(e.sonification_mode=Object.assign(constants.sonifMode)),this.isUndefinedOrNull(constants.brailleMode)||(e.braille_mode=Object.assign(constants.brailleMode)),this.isUndefinedOrNull(constants.layer)||(e.layer=Object.assign(constants.layer)),this.isUndefinedOrNull(constants.chartType)||(e.chart_type=Object.assign(constants.chartType)),!this.isUndefinedOrNull(constants.infoDiv.innerHTML)){let t=Object.assign(constants.infoDiv.innerHTML);t=t.replaceAll(/<[^>]*>?/gm,""),e.text_display=t}this.isUndefinedOrNull(location.href)||(e.location=Object.assign(location.href));let n="",o="",s="",i="",a="",l="";if("barplot"==constants.chartType)this.isUndefinedOrNull(plot.columnLabels[position.x])||(n=plot.columnLabels[position.x]),this.isUndefinedOrNull(plot.plotLegend.x)||(s=plot.plotLegend.x),this.isUndefinedOrNull(plot.plotLegend.y)||(i=plot.plotLegend.y),this.isUndefinedOrNull(plot.plotData[position.x])||(a=plot.plotData[position.x]);else if("heatmap"==constants.chartType)this.isUndefinedOrNull(plot.x_labels[position.x])||(n=plot.x_labels[position.x].trim()),this.isUndefinedOrNull(plot.y_labels[position.y])||(o=plot.y_labels[position.y].trim()),this.isUndefinedOrNull(plot.x_group_label)||(s=plot.x_group_label),this.isUndefinedOrNull(plot.y_group_label)||(i=plot.y_group_label),this.isUndefinedOrNull(plot.values)||this.isUndefinedOrNull(plot.values[position.x][position.y])||(a=plot.values[position.x][position.y]),this.isUndefinedOrNull(plot.group_labels[2])||(l=plot.group_labels[2]);else if("boxplot"==constants.chartType){let t="vert"==constants.plotOrientation?position.x:position.y,e="vert"==constants.plotOrientation?position.y:position.x;this.isUndefinedOrNull(plot.x_group_label)||(s=plot.x_group_label),this.isUndefinedOrNull(plot.y_group_label)||(i=plot.y_group_label),"vert"==constants.plotOrientation?t>-1&&e>-1&&(this.isUndefinedOrNull(plot.plotData[t][e].label)||(o=plot.plotData[t][e].label),this.isUndefinedOrNull(plot.x_labels[position.x])||(n=plot.x_labels[position.x]),this.isUndefinedOrNull(plot.plotData[t][e].values)?this.isUndefinedOrNull(plot.plotData[t][e].y)||(a=plot.plotData[t][e].y):a=plot.plotData[t][e].values):t>-1&&e>-1&&(this.isUndefinedOrNull(plot.plotData[t][e].label)||(n=plot.plotData[t][e].label),this.isUndefinedOrNull(plot.y_labels[position.y])||(o=plot.y_labels[position.y]),this.isUndefinedOrNull(plot.plotData[t][e].values)?this.isUndefinedOrNull(plot.plotData[t][e].x)||(a=plot.plotData[t][e].x):a=plot.plotData[t][e].values)}else"scatterplot"==constants.chartType&&(this.isUndefinedOrNull(plot.x_group_label)||(s=plot.x_group_label),this.isUndefinedOrNull(plot.y_group_label)||(i=plot.y_group_label),this.isUndefinedOrNull(plot.x[position.x])||(n=plot.x[position.x]),this.isUndefinedOrNull(plot.y[position.x])||(o=plot.y[position.x]),a=[n,o]);e.x_tickmark=Object.assign(n),e.y_tickmark=Object.assign(o),e.x_label=Object.assign(s),e.y_label=Object.assign(i),e.value=Object.assign(a),e.fill_value=Object.assign(l);let r=this.GetTrackerData();r.events.push(e),this.SaveTrackerData(r)}isUndefinedOrNull(t){try{return null==t}catch{return!0}}}class Review{constructor(){document.getElementById(constants.review_id)||document.getElementById(constants.info_id)&&document.getElementById(constants.info_id).insertAdjacentHTML("beforebegin",'<div id="'+constants.review_id_container+'" class="hidden sr-only sr-only-focusable"><input id="'+constants.review_id+'" type="text" readonly size="50" /></div>'),constants&&(constants.review_container=document.querySelector("#"+constants.review_id_container),constants.review=document.querySelector("#"+constants.review_id))}ToggleReviewMode(t=!0){t?(constants.reviewSaveSpot=document.activeElement,constants.review_container.classList.remove("hidden"),constants.reviewSaveBrailleMode=constants.brailleMode,constants.review.focus(),display.announceText("Review on")):(constants.review_container.classList.add("hidden"),"on"==constants.reviewSaveBrailleMode?display.toggleBrailleMode("on"):constants.reviewSaveSpot.focus(),display.announceText("Review off"))}}class Audio{constructor(){this.AudioContext=window.AudioContext||window.webkitAudioContext,this.audioContext=new AudioContext,this.compressor=this.compressorSetup(this.audioContext)}compressorSetup(){let t=this.audioContext.createDynamicsCompressor();t.threshold.value=-50,t.knee.value=40,t.ratio.value=12,t.attack.value=0,t.release.value=.25;let e=this.audioContext.createGain();return e.gain.value=constants.vol,t.connect(e),e.connect(this.audioContext.destination),t}playTone(){let t=constants.duration,e=constants.vol,n=0,o=0,s=0,i=0;if("barplot"==constants.chartType)o=plot.plotData[position.x],n=position.x,s=this.SlideBetween(o,constants.minY,constants.maxY,constants.MIN_FREQUENCY,constants.MAX_FREQUENCY),i=this.SlideBetween(n,constants.minX,constants.maxX,-1,1);else if("boxplot"==constants.chartType){let t="vert"==constants.plotOrientation?position.x:position.y,e="vert"==constants.plotOrientation?position.y:position.x;o=position.z>-1&&Object.hasOwn(plot.plotData[t][e],"values")?plot.plotData[t][e].values[position.z]:"vert"==constants.plotOrientation?plot.plotData[t][e].y:plot.plotData[t][e].x,"blank"!=plot.plotData[t][e].type?"vert"==constants.plotOrientation?(s=this.SlideBetween(o,constants.minY,constants.maxY,constants.MIN_FREQUENCY,constants.MAX_FREQUENCY),i=this.SlideBetween(o,constants.minY,constants.maxY,-1,1)):(s=this.SlideBetween(o,constants.minX,constants.maxX,constants.MIN_FREQUENCY,constants.MAX_FREQUENCY),i=this.SlideBetween(o,constants.minX,constants.maxX,-1,1)):(s=constants.MIN_FREQUENCY,i=0)}else"heatmap"==constants.chartType?(o=plot.values[position.y][position.x],n=position.x,s=this.SlideBetween(o,constants.minY,constants.maxY,constants.MIN_FREQUENCY,constants.MAX_FREQUENCY),i=this.SlideBetween(n,constants.minX,constants.maxX,-1,1)):"scatterplot"==constants.chartType&&(1==constants.layer?(o=plot.y[position.x][position.z],e=1==plot.max_count?constants.vol:this.SlideBetween(plot.points_count[position.x][position.z],1,plot.max_count,constants.vol,constants.MAX_VOL),n=position.x,s=this.SlideBetween(o,constants.minY,constants.maxY,constants.MIN_FREQUENCY,constants.MAX_FREQUENCY),i=this.SlideBetween(n,constants.minX,constants.maxX,-1,1)):2==constants.layer&&(o=plot.curvePoints[positionL1.x],n=positionL1.x,s=this.SlideBetween(o,plot.curveMinY,plot.curveMaxY,constants.MIN_FREQUENCY,constants.MAX_FREQUENCY),i=this.SlideBetween(n,constants.minX,constants.maxX,-1,1)));if(constants.debugLevel>5&&(console.log("will play tone at freq",s),"boxplot"==constants.chartType?console.log("based on",constants.minY,"<",o,"<",constants.maxY," | freq min",constants.MIN_FREQUENCY,"max",constants.MAX_FREQUENCY):console.log("based on",constants.minX,"<",o,"<",constants.maxX," | freq min",constants.MIN_FREQUENCY,"max",constants.MAX_FREQUENCY)),"boxplot"==constants.chartType){let e="vert"==constants.plotOrientation?position.x:position.y,n="vert"==constants.plotOrientation?position.y:position.x,o=plot.plotData[e][n].type;"outlier"==o&&(t=constants.outlierDuration)}if(this.playOscillator(s,t,i,e,"sine"),"boxplot"==constants.chartType){let e="vert"==constants.plotOrientation?position.x:position.y,n="vert"==constants.plotOrientation?position.y:position.x;if("range"==plot.plotData[e][n].type){let e=s/2;this.playOscillator(e,t,i,constants.vol/4,"triangle")}}else"heatmap"==constants.chartType&&0==o&&this.PlayNull()}playOscillator(t,e,n,o=1,s="sine"){const i=this.audioContext.currentTime,a=this.audioContext.createOscillator();a.type=s,a.frequency.value=parseFloat(t),a.start();const l=this.audioContext.createGain();l.gain.setValueCurveAtTime([.5*o,1*o,.5*o,.5*o,.5*o,.1*o,1e-4*o],i,e);const r=new PannerNode(this.audioContext,{panningModel:"HRTF",distanceModel:"linear",positionX:position.x,positionY:position.y,positionZ:1,plotOrientationX:0,plotOrientationY:0,plotOrientationZ:-1,refDistance:1,maxDistance:1e4,rolloffFactor:10,coneInnerAngle:40,coneOuterAngle:50,coneOuterGain:.4}),p=this.audioContext.createStereoPanner();p.pan.value=n,a.connect(l),l.connect(p),p.connect(r),r.connect(this.compressor),setTimeout((()=>{r.disconnect(),l.disconnect(),a.stop(),a.disconnect()}),1e3*e*2)}playSmooth(t=[600,500,400,300],e=2,n=[-1,0,1],o=1,s="sine"){let i=new Array(3*t.length).fill(.5*o);i.push(1e-4*o);const a=this.audioContext.currentTime,l=this.audioContext.createOscillator();l.type=s,l.frequency.setValueCurveAtTime(t,a,e),l.start(),constants.isSmoothAutoplay=!0,this.smoothGain=this.audioContext.createGain(),this.smoothGain.gain.setValueCurveAtTime(i,a,e);const r=new PannerNode(this.audioContext,{panningModel:"HRTF",distanceModel:"linear",positionX:position.x,positionY:position.y,positionZ:1,plotOrientationX:0,plotOrientationY:0,plotOrientationZ:-1,refDistance:1,maxDistance:1e4,rolloffFactor:10,coneInnerAngle:40,coneOuterAngle:50,coneOuterGain:.4}),p=this.audioContext.createStereoPanner();p.pan.setValueCurveAtTime(n,a,e),l.connect(this.smoothGain),this.smoothGain.connect(p),p.connect(r),r.connect(this.compressor),constants.smoothId=setTimeout((()=>{r.disconnect(),this.smoothGain.disconnect(),l.stop(),l.disconnect(),constants.isSmoothAutoplay=!1}),1e3*e*2)}PlayNull(){console.log("playing null");let t=constants.NULL_FREQUENCY,e=constants.duration,n=constants.vol,o="triangle";this.playOscillator(t,e,0,n,o),setTimeout((function(s){s.playOscillator(23*t/24,e,0,n,o)}),Math.round(e/5*1e3),this)}playEnd(){if(constants.canPlayEndChime){let t=constants.endChime.cloneNode(!0);t.play(),t=null}}KillSmooth(){constants.smoothId&&(this.smoothGain.gain.cancelScheduledValues(0),this.smoothGain.gain.exponentialRampToValueAtTime(1e-4,this.audioContext.currentTime+.03),clearTimeout(constants.smoothId),constants.isSmoothAutoplay=!1)}SlideBetween(t,e,n,o,s){let i=(t-e)/(n-e)*(s-o)+o;return 0==e&&0==n&&(i=0),i}}class Display{constructor(){this.infoDiv=constants.infoDiv,this.x={},this.x.id="x",this.x.textBase="x-value: ",this.y={},this.y.id="y",this.y.textBase="y-value: ",this.boxplotGridPlaceholders=[resources.GetString("lower_outlier"),resources.GetString("min"),resources.GetString("25"),resources.GetString("50"),resources.GetString("75"),resources.GetString("max"),resources.GetString("upper_outlier")]}toggleTextMode(){"off"==constants.textMode?constants.textMode="terse":"terse"==constants.textMode?constants.textMode="verbose":"verbose"==constants.textMode&&(constants.textMode="off"),this.announceText('<span aria-hidden="true">Text mode:</span> '+constants.textMode)}toggleBrailleMode(t){if("scatterplot"!=constants.chartType||1!=constants.layer){if(void 0===t&&(t="on"==constants.brailleMode?"off":"on"),"on"==t){if("boxplot"==constants.chartType&&("vert"!=constants.plotOrientation&&-1==position.x&&position.y==plot.plotData.length?(position.x+=1,position.y-=1):"vert"==constants.plotOrientation&&0==position.x&&(position.y,plot.plotData[0].length)),constants.brailleMode="on",constants.brailleInput.classList.remove("hidden"),constants.brailleInput.focus(),constants.brailleInput.setSelectionRange(position.x,position.x),this.SetBraille(plot),"heatmap"==constants.chartType){let t=position.y*(plot.num_cols+1)+position.x;constants.brailleInput.setSelectionRange(t,t)}-1==position.x&&-1==position.y&&constants.brailleInput.setSelectionRange(0,0)}else constants.brailleMode="off",constants.brailleInput.classList.add("hidden"),constants.review_container?constants.review_container.classList.contains("hidden")?constants.svg.focus():constants.review.focus():constants.svg.focus();this.announceText("Braille "+constants.brailleMode)}else this.announceText("Braille is not supported in point layer.")}toggleSonificationMode(){"scatterplot"==constants.chartType&&1==constants.layer?"off"==constants.sonifMode?(constants.sonifMode="sep",this.announceText(resources.GetString("son_sep"))):"sep"==constants.sonifMode?(constants.sonifMode="same",this.announceText(resources.GetString("son_same"))):"same"==constants.sonifMode&&(constants.sonifMode="off",this.announceText(resources.GetString("son_off"))):"off"==constants.sonifMode?(constants.sonifMode="on",this.announceText(resources.GetString("son_on"))):(constants.sonifMode="off",this.announceText(resources.GetString("son_off")))}toggleLayerMode(){1==constants.layer?(constants.layer=2,this.announceText("Layer 2: Smoothed line")):2==constants.layer&&(constants.layer=1,this.announceText("Layer 1: Point"))}announceText(t){constants.announceContainer.innerHTML=t}UpdateBraillePos(){if("barplot"==constants.chartType)constants.brailleInput.setSelectionRange(position.x,position.x);else if("heatmap"==constants.chartType){let t=position.y*(plot.num_cols+1)+position.x;constants.brailleInput.setSelectionRange(t,t)}else if("boxplot"==constants.chartType){let t="vert"==constants.plotOrientation?position.y:position.x,e=this.boxplotGridPlaceholders[t],n=!1,o=0;if(!constants.brailleData)throw"Braille data not set up, cannot move cursor in braille, sorry.";for(let t=0;t<constants.brailleData.length;t++){if("blank"!=constants.brailleData[t].type&&resources.GetString(constants.brailleData[t].label)==e){n=!0;break}o+=constants.brailleData[t].numChars}n||(o=0),constants.brailleInput.setSelectionRange(o,o)}else"scatterplot"==constants.chartType&&constants.brailleInput.setSelectionRange(positionL1.x,positionL1.x)}displayValues(t){let e="",n="";if("barplot"==constants.chartType)n=t.plotLegend.x+" is "+t.columnLabels[position.x]+", "+t.plotLegend.y+" is "+t.plotData[position.x],"off"==constants.textMode||("terse"==constants.textMode?e+="<p>"+t.columnLabels[position.x]+" "+t.plotData[position.x]+"</p>\n":"verbose"==constants.textMode&&(e+="<p>"+n+"</p>\n"));else if("heatmap"==constants.chartType)1==constants.navigation?(n+=t.x_group_label+" "+t.x_labels[position.x]+", "+t.y_group_label+" "+t.y_labels[position.y]+", "+t.box_label+" is ",constants.hasRect&&(n+=t.plotData[2][position.y][position.x])):(n+=t.y_group_label+" "+t.y_labels[position.y]+", "+t.x_group_label+" "+t.x_labels[position.x]+", "+t.box_label+" is ",constants.hasRect&&(n+=t.plotData[2][position.y][position.x])),"off"==constants.textMode||("terse"==constants.textMode?1==constants.navigation?e+="<p>"+t.x_labels[position.x]+", "+t.plotData[2][position.y][position.x]+"</p>\n":e+="<p>"+t.y_labels[position.y]+", "+t.plotData[2][position.y][position.x]+"</p>\n":"verbose"==constants.textMode&&(e+="<p>"+n+"</p>\n"));else if("boxplot"==constants.chartType){let o=0,s=1,i=!1,a="vert"==constants.plotOrientation?position.x:position.y,l="vert"==constants.plotOrientation?position.y:position.x,r="",p="";"lower_outlier"!=t.plotData[a][l].label&&"upper_outlier"!=t.plotData[a][l].label||(i=!0),"outlier"==t.plotData[a][l].type?(o=t.plotData[a][l].values.join(", "),s=t.plotData[a][l].values.length>0?t.plotData[a][l].values.length:0):"blank"==t.plotData[a][l].type?(o="",i&&(s=0)):o="vert"==constants.plotOrientation?t.plotData[a][l].y:t.plotData[a][l].x,constants.navigation?t.x_group_label&&(p+=t.x_group_label):constants.navigation||t.y_group_label&&(p+=t.y_group_label),constants.navigation?t.x_labels[a]?(p+=" is ",r+=t.x_labels[a]+", ",p+=t.x_labels[a]+", "):p+=", ":constants.navigation||(t.y_labels[a]?(p+=" is ",r+=t.y_labels[a]+", ",p+=t.y_labels[a]+", "):p+=", "),i&&(r+=s+" ",p+=s+" "),p+=resources.GetString(t.plotData[a][l].label),1==s?p+=" is ":(p+="s ",s>1&&(p+=" are ")),(i||constants.navigation&&"horz"==constants.plotOrientation||!constants.navigation&&"vert"==constants.plotOrientation)&&(r+=resources.GetString(t.plotData[a][l].label),1!=s&&(r+="s"),r+=" "),"blank"!=t.plotData[a][l].type||i?(r+=o,p+=o):(r+="empty",p+="empty"),n=p,"verbose"==constants.textMode?e="<p>"+p+"</p>\n":"terse"==constants.textMode&&(e="<p>"+r+"</p>\n")}else"scatterplot"==constants.chartType&&(1==constants.layer?(n+=t.x_group_label+" "+t.x[position.x]+", "+t.y_group_label+" ["+t.y[position.x].join(", ")+"]","off"==constants.textMode||("terse"==constants.textMode?e+="<p>"+t.x[position.x]+", ["+t.y[position.x].join(", ")+"]</p>\n":constants.textMode)):2==constants.layer&&(n+=t.x_group_label+" "+t.curveX[positionL1.x]+", "+t.y_group_label+" "+t.curvePoints[positionL1.x],"off"==constants.textMode||("terse"==constants.textMode?e+="<p>"+t.curvePoints[positionL1.x]+"<p>\n":constants.textMode)),"verbose"==constants.textMode&&(e="<p>"+n+"</p>\n"));constants.infoDiv&&(constants.infoDiv.innerHTML=e),constants.review&&(e.length>0?constants.review.value=e.replace(/<[^>]*>?/gm,""):constants.review.value=n)}displayXLabel(t){let e="";"barplot"==constants.chartType?e=t.plotLegend.x:"heatmap"!=constants.chartType&&"boxplot"!=constants.chartType&&"scatterplot"!=constants.chartType||(e=t.x_group_label),"terse"==constants.textMode?constants.infoDiv.innerHTML="<p>"+e+"<p>":"verbose"==constants.textMode&&(constants.infoDiv.innerHTML="<p>x label is "+e+"<p>")}displayYLabel(t){let e="";"barplot"==constants.chartType?e=t.plotLegend.y:"heatmap"!=constants.chartType&&"boxplot"!=constants.chartType&&"scatterplot"!=constants.chartType||(e=t.y_group_label),"terse"==constants.textMode?constants.infoDiv.innerHTML="<p>"+e+"<p>":"verbose"==constants.textMode&&(constants.infoDiv.innerHTML="<p>y label is "+e+"<p>")}displayTitle(t){"terse"==constants.textMode?""!=t.title?constants.infoDiv.innerHTML="<p>"+t.title+"<p>":constants.infoDiv.innerHTML="<p>Plot does not have a title.<p>":"verbose"==constants.textMode&&(""!=t.title?constants.infoDiv.innerHTML="<p>Title is "+t.title+"<p>":constants.infoDiv.innerHTML="<p>Plot does not have a title.<p>")}displayFill(t){"terse"==constants.textMode?"heatmap"==constants.chartType&&(constants.infoDiv.innerHTML="<p>"+t.box_label+"<p>"):"verbose"==constants.textMode&&"heatmap"==constants.chartType&&(constants.infoDiv.innerHTML="<p>Fill label is "+t.box_label+"<p>")}SetBraille(t){let e=[];if("heatmap"==constants.chartType){let n=(constants.maxY-constants.minY)/3,o=constants.minY+n,s=o+n;for(let n=0;n<t.y_coord.length;n++){for(let i=0;i<t.x_coord.length;i++)0==t.values[n][i]?e.push("⠀"):t.values[n][i]<=o?e.push("⠤"):t.values[n][i]<=s?e.push("⠒"):e.push("⠉");e.push("⠳")}}else if("barplot"==constants.chartType){let n=(constants.maxY-constants.minY)/4,o=constants.minY+n,s=o+n,i=s+n;for(let n=0;n<t.plotData.length;n++)t.plotData[n]<=o?e.push("⣀"):t.plotData[n]<=s?e.push("⠤"):t.plotData[n]<=i?e.push("⠒"):e.push("⠉")}else if("scatterplot"==constants.chartType){let n=(t.curveMaxY-t.curveMinY)/4,o=t.curveMinY+n,s=o+n,i=s+n,a=i+n;for(let n=0;n<t.curvePoints.length;n++)t.curvePoints[n]<=o?e.push("⣀"):t.curvePoints[n]<=s?e.push("⠤"):t.curvePoints[n]<=i?e.push("⠒"):t.curvePoints[n]<=a&&e.push("⠉")}else if("boxplot"==constants.chartType&&position.y>-1){let o=[],s=!0,i="vert"==constants.plotOrientation?position.x:position.y,a="vert"==constants.plotOrientation?"y":"x";for(let e=0;e<t.plotData[i].length;e++){let l=t.plotData[i][e];l.values&&constants.visualBraille&&(l.values=[...new Set(l.values)]);let r=null,p=null;e<t.plotData[i].length-1&&(r=t.plotData[i][e+1]),e>0&&(p=t.plotData[i][e-1]);let c={};if(0==e){let e=0;for(let n=0;n<t.plotData[i].length;n++)if(a in t.plotData[i][n]){e=t.plotData[i][n][a];break}c={};let n="vert"==constants.plotOrientation?constants.minY:constants.minX;c.length=e-n>0?e:0,c.length<0&&(c.length=0),c.type="blank",c.label="blank",o.push(c)}if("blank"==l.type);else if("outlier"==l.type){s||(c={},c.length=l.values[0]-p[a],c.type="blank",c.label="blank",o.push(c));for(var n=0;n<l.values.length;n++)0==n?(c={},c.length=0,c.type="outlier",c.label=l.label,o.push(c)):(c={},c.length=l.values[n]-l.values[n-1],c.type="blank",c.label="blank",o.push(c),c={},c.length=0,c.type="outlier",c.label=l.label,o.push(c));s&&(c={},c.length=r[a]-l.values[l.values.length-1],c.type="blank",c.label="blank",o.push(c))}else"50"==l.label?(c={},c.length=0,c.type=l.type,c.label=l.label,o.push(c),s=!1):(c={},c.length=s?r[a]-l[a]:l[a]-p[a],c.type=l.type,c.label=l.label,o.push(c));if(e==t.plotData[i].length-1){c={};let e=0;for(let n=0;n<t.plotData[i].length;n++)"outlier"==l.type?e="y"==a?l.yMax:l.xMax:a in t.plotData[i][n]&&(e=t.plotData[i][n][a]);c.length="y"==a?constants.maxY-e:constants.maxX-e,c.type="blank",c.label="blank",o.push(c)}}for(let t=0;t<o.length;t++)o[t].length=Math.round(o[t].length);let l=-1,r=-1,p=-1,c=-1,h=0;for(let t=0;t<o.length;t++)"blank"!=o[t].type&&(o[t].length>0||"outlier"==o[t].type)?(o[t].numChars=1,h++):o[t].numChars=0,"min"==o[t].label&&o[t].length>0&&(l=t),"max"==o[t].label&&o[t].length>0&&(r=t),"25"==o[t].label&&(p=t),"75"==o[t].label&&(c=t),"50"==o[t].label&&(o[t].numChars=2,h++);let d=["25","75"];l>-1&&r>-1&&(d.push("min"),d.push("max"),o[l].length!=o[r].length&&(o[l].length>o[r].length?(o[l].numChars++,h++):(o[r].numChars++,h++))),o[p].length!=o[c].length&&(o[p].length>o[c].length?(o[p].numChars++,h++):(o[c].numChars++,h++));let u=constants.brailleDisplayLength-h,y=this.AllocateCharacters(o,u);for(let t=0;t<y.length;t++)y[t]&&(o[t].numChars+=y[t]);constants.brailleData=o,constants.debugLevel>5&&(console.log("plotData[i]",t.plotData[i]),console.log("brailleData",o));for(let t=0;t<o.length;t++)for(let n=0;n<o[t].numChars;n++){let s="⠀";"min"==o[t].label||"max"==o[t].label?s="⠒":"25"==o[t].label||"75"==o[t].label?s="⠿":"50"==o[t].label?s=0==n?"⠸":"⠇":"outlier"==o[t].type&&(s="⠂"),e.push(s)}}constants.brailleInput.value=e.join(""),constants.brailleInput.value=e.join(""),constants.debugLevel>5&&console.log("braille:",constants.brailleInput.value),this.UpdateBraillePos()}CharLenImpact(t){return t.length/t.numChars}AllocateCharacters(t,e){let n=[],o=0;for(let e=0;e<t.length;e++)o+=t[e].length;let s=["lower_outlier","upper_outlier","50"];for(let i=0;i<t.length;i++)s.includes(t[i].label)||(n[i]=Math.round(t[i].length/o*e));let i=n.reduce(((t,e)=>t+e),0),a=e-i,l=t.length;for(;0!==a&&l>0;){for(let e=0;e<t.length;e++)s.includes(t[e].label)||(n[e]+=Math.round(t[e].length/o*a));i=n.reduce(((t,e)=>t+e),0),a=e-i,l--}if(0!==a){let e=[];for(let n=0;n<t.length;n++)e.push(n);e.sort(((t,e)=>n[t]-n[e]));let o=-1;a>0&&(o=1);let s=0,i=3*e.length;for(;a>0&&i>0;)n[e[s]]+=o,a+=-o,s+=1,s>=e.length&&(s=0),i+=-1}return n}}class BarChart{constructor(){"elements"in maidr?(this.bars=maidr.elements,constants.hasRect=1):(this.bars=document.querySelectorAll('g[id^="geom_rect"] > rect'),constants.hasRect=0),this.columnLabels=[];let t="",e="";"axes"in maidr?(maidr.axes.x&&maidr.axes.x.label&&(t=maidr.axes.x.label),maidr.axes.y&&maidr.axes.y.label&&(e=maidr.axes.y.label),maidr.axes.x&&maidr.axes.x.format&&(this.columnLabels=maidr.axes.x.format),maidr.axes.y&&maidr.axes.y.format&&(this.columnLabels=maidr.axes.y.format)):(document.querySelector('g[id^="xlab"] tspan')&&(t=document.querySelector('g[id^="xlab"] tspan').innerHTML),document.querySelector('g[id^="ylab"] tspan')&&(e=document.querySelector('g[id^="ylab"] tspan').innerHTML),this.columnLabels=this.ParseInnerHTML(document.querySelectorAll('g:not([id^="xlab"]):not([id^="ylab"]) > g > g > g > text[text-anchor="middle"]'))),this.plotLegend={x:t,y:e},this.title="","title"in maidr?this.title=maidr.title:document.querySelector('g[id^="plot.title..titleGrob"] tspan')&&(this.title=document.querySelector('g[id^="plot.title..titleGrob"] tspan').innerHTML,this.title=this.title.replace("\n","").replace(/ +(?= )/g,"")),"array"==typeof maidr?this.plotData=maidr:"object"==typeof maidr&&"data"in maidr&&(this.plotData=maidr.data),this.SetMaxMin(),this.autoplay=null}SetMaxMin(){for(let t=0;t<this.plotData.length;t++)0==t?(constants.maxY=this.plotData[t],constants.minY=this.plotData[t]):(this.plotData[t]>constants.maxY&&(constants.maxY=this.plotData[t]),this.plotData[t]<constants.minY&&(constants.minY=this.plotData[t]));constants.maxX=this.columnLabels.length}GetLegendFromManualData(){let t={};return t.x=barplotLegend.x,t.y=barplotLegend.y,t}GetData(){let t=[];if(this.bars)for(let e=0;e<this.bars.length;e++)t.push(this.bars[e].getAttribute("height"));return t}GetColumns(){let t=[],e=document.querySelectorAll('tspan[dy="10"]');for(var n=0;n<e.length;n++)t.push(e[n].innerHTML);return t}GetLegend(){let t={},e=document.querySelectorAll('tspan[dy="12"]');return t.x=e[1].innerHTML,t.y=e[0].innerHTML,t}ParseInnerHTML(t){let e=[];for(var n=0;n<t.length;n++)e.push(t[n].innerHTML);return e}Select(){this.DeselectAll(),this.bars&&(this.bars[position.x].style.fill=constants.colorSelected)}DeselectAll(){if(this.bars)for(let t=0;t<this.bars.length;t++)this.bars[t].style.fill=constants.colorUnselected}}class BoxPlot{constructor(){if(constants.plotId=0,constants.plotOrientation="horz","undefined"!=typeof maidr&&(constants.plotOrientation=maidr.orientation),document.querySelector('g[id^="panel"] > g[id^="geom_boxplot.gTree"]')&&(constants.plotId=document.querySelector('g[id^="panel"] > g[id^="geom_boxplot.gTree"]').getAttribute("id")),constants.manualData){let t="";"undefined"!=typeof maidr&&void 0!==maidr.title?t=maidr.title:document.querySelector('tspan[dy="9.45"]')&&(t=document.querySelector('tspan[dy="9.45"]').innerHTML,t=t.replace("\n","").replace(/ +(?= )/g,"")),this.title=void 0!==t&&null!=typeof t?t:"","undefined"!=typeof maidr?this.x_group_label=maidr.x_group_label:this.x_group_label=document.querySelector('text:not([transform^="rotate"]) > tspan[dy="7.88"]').innerHTML,"undefined"!=typeof maidr?this.y_group_label=maidr.y_group_label:this.y_group_label=document.querySelector('text[transform^="rotate"] > tspan[dy="7.88"]').innerHTML;let e=[];if("undefined"!=typeof maidr)this.x_labels=maidr.x_labels,this.y_labels=maidr.y_labels;else{let t="3.15";"vert"==constants.plotOrientation&&(t="6.3");let n=document.querySelectorAll('tspan[dy="'+t+'"]');for(let t=0;t<n.length;t++)e.push(n[t].innerHTML.trim());"vert"==constants.plotOrientation?(this.x_labels=e,this.y_labels=[]):(this.x_labels=[],this.y_labels=e)}"undefined"!=typeof maidr?this.plotData=maidr.data:this.plotData=maidr}else this.x_group_label=document.getElementById("GRID.text.199.1.1.tspan.1").innerHTML,this.y_group_label=document.getElementById("GRID.text.202.1.1.tspan.1").innerHTML,"vert"==constants.plotOrientation?(this.x_labels=this.GetLabels(),this.y_labels=[]):(this.x_labels=[],this.y_labels=this.GetLabels()),this.plotData=this.GetData();constants.plotId?(this.plotBounds=this.GetPlotBounds(constants.plotId),constants.hasRect=!0):constants.hasRect=!1,this.CleanData()}GetLabels(){let t=[],e=document.querySelectorAll('tspan[dy="5"]');for(let n=0;n<e.length;n++)t.push(e[n].innerHTML.trim());return t}CleanData(){if("vert"==constants.plotOrientation){constants.minY=0,constants.maxY=0;for(let t=0;t<this.plotData.length;t++)for(let e=0;e<this.plotData[t].length;e++){let n=this.plotData[t][e];n.hasOwnProperty("y")&&(n.y<constants.minY&&(constants.yMin=n.y),n.hasOwnProperty("yMax")?n.yMax>constants.maxY&&(constants.maxY=n.yMax):n.y>constants.maxY&&(constants.maxY=n.y)),n.hasOwnProperty("x")&&(n.x<constants.minX&&(constants.minX=n.x),n.x>constants.maxX&&(constants.maxX=n.x))}}else{constants.minX=0,constants.maxX=0;for(let t=0;t<this.plotData.length;t++)for(let e=0;e<this.plotData[t].length;e++){let n=this.plotData[t][e];n.hasOwnProperty("x")&&(n.x<constants.minX&&(constants.xMin=n.x),n.hasOwnProperty("xMax")?n.xMax>constants.maxX&&(constants.maxX=n.xMax):n.x>constants.maxX&&(constants.maxX=n.x)),n.hasOwnProperty("y")&&(n.y<constants.minY&&(constants.minY=n.y),n.y>constants.maxY&&(constants.maxY=n.y))}}}GetData(){let t=[],e=document.getElementById(constants.plotId).children;for(let n=0;n<e.length;n++){let o=e[n].children,s=[];for(let t=0;t<o.length;t++){let e=o[t].children;for(let n=0;n<e.length;n++){let i=e[n],a=this.GetBoxplotSegmentType(o[t].getAttribute("id")),l=this.GetBoxplotSegmentPoints(i,a);for(let t=0;t<l.length;t+=2)if("whisker"==a&&0==t&&"vert"==constants.plotOrientation);else{let e={x:Number(l[t]),y:Number(l[t+1]),type:a};e.y>constants.maxY&&(constants.maxY=e.y),s.push(e)}}}if(s.sort((function(t,e){return"vert"==constants.plotOrientation?t.y-e.y:t.x-e.x})),"horz"==constants.plotOrientation){let t=[];for(let e=0;e<s.length;e++)e>0&&s[e-1].x==s[e].x?"whisker"==s[e-1].type&&(t.splice(-1,1),t.push(s[e])):t.push(s[e]);s=t}t.push(s)}t.sort((function(t,e){return"vert"==constants.plotOrientation?t[0].x-e[0].x:t[0].y-e[0].y}));for(let e=0;e<t.length;e++){let n=t[e],o=[];for(let s=0;s<n.length+1;s++){let i=!1;if((s==n.length||"outlier"!=n[s].type)&&(i=!0),i){if(o.length>0){let n=[];for(let i=0;i<o.length;i++)"vert"==constants.plotOrientation?n.push(o[i].y):n.push(o[i].x),i>0&&(t[e][s+i-o.length].type="delete");"vert"==constants.plotOrientation?(t[e][s-o.length].y=o[0].y,t[e][s-o.length].yMax=o[o.length-1].y):(t[e][s-o.length].x=o[0].x,t[e][s-o.length].xMax=o[o.length-1].x),t[e][s-o.length].values=n,o=[]}}else o.push(n[s])}}let n=[];for(let e=0;e<t.length;e++){n[e]=[];for(let o=0;o<t[e].length;o++)"delete"!=t[e][o].type&&(n[e][o]=t[e][o]);n[e]=n[e].filter((function(){return!0}))}t=n;for(let e=0;e<t.length;e++){let n=0;for(let o=0;o<t[e].length;o++){let s=t[e][o];"outlier"==s.type?t[e][o].label=n>0?resources.GetString("upper_outlier"):resources.GetString("lower_outlier"):"whisker"==s.type?t[e][o].label=n>0?resources.GetString("max"):resources.GetString("min"):"range"==s.type&&(0==n?t[e][o].label=resources.GetString("25"):1==n?t[e][o].label=resources.GetString("50"):2==n&&(t[e][o].label=resources.GetString("75")),n++)}}let o=this.GetAllSegmentTypes();for(let e=0;e<t.length;e++)if(7==t[e].length);else{let n=[];for(let o=0;o<t[e].length;o++)n.push(t[e][o].label);for(let s=0;s<o.length;s++)if(!n.includes(o[s])){let i={type:"blank",label:o[s]};t[e].splice(s,0,i),n.splice(s,0,o[s])}}for(let e=0;e<t.length;e++)t[e][3].y=Math.round((t[e][2].y+t[e][4].y)/2);return constants.debugLevel>1&&console.log("plotData:",t),t}GetPlotBounds(t){let e=[],n=this.GetAllSegmentTypes(),o=/(?:\d+(?:\.\d*)?|\.\d+)/g,s=[],i=document.getElementById(constants.plotId).children;for(let t=0;t<i.length;t++){let e={},n=i[t].children;for(let t=0;t<n.length;t++){e[this.GetBoxplotSegmentType(n[t].getAttribute("id"))]=n[t]}s.push(e)}for(let t=0;t<s.length;t++){let i=[],a=s[t].range.getBoundingClientRect(),l=s[t].range.querySelector('polyline[id^="GRID"]').getAttribute("points").match(o),r=s[t].range.querySelector('polygon[id^="geom_polygon"]').getAttribute("points").match(o),p=0;p="vert"==constants.plotOrientation?(l[1]-r[3])/(r[1]-r[3]):(l[0]-r[2])/(r[0]-r[2]);let c=0;if(c="vert"==constants.plotOrientation?a.height*p:a.width*p,i[2]=this.convertBoundingClientRectToObj(a),i[2].label=n[2],i[2].type="range","vert"==constants.plotOrientation?(i[2].height=c,i[2].top=i[2].bottom-c,i[2].y=i[2].top):i[2].width=c,i[3]=this.convertBoundingClientRectToObj(a),i[3].label=n[3],i[3].type="range","vert"==constants.plotOrientation?(i[3].height=0,i[3].top=a.bottom-c,i[3].y=i[3].top,i[3].bottom=i[3].top):(i[3].width=0,i[3].left=a.left+c),i[4]=this.convertBoundingClientRectToObj(a),i[4].label=n[4],i[4].type="range","vert"==constants.plotOrientation?(i[4].height=a.height-c,i[4].bottom=i[3].top):(i[4].width=a.width-c,i[4].left=i[3].left),Object.hasOwn(s[t],"whisker")){let e=s[t].whisker.getBoundingClientRect(),o=!1,l=!1;"vert"==constants.plotOrientation?(e.bottom>a.bottom&&(o=!0),e.top<a.top&&(l=!0)):(e.left<a.left&&(o=!0),e.right>a.right&&(l=!0)),o?(i[1]=this.convertBoundingClientRectToObj(e),i[1].label=n[1],i[1].type="whisker","vert"==constants.plotOrientation?(i[1].top=i[2].bottom,i[1].y=i[1].top,i[1].height=i[1].bottom-i[1].top):i[1].width=i[2].left-i[1].left):(i[1]={},i[1].label=n[1],i[1].type="blank"),l?(i[5]=this.convertBoundingClientRectToObj(e),i[5].label=n[5],i[5].type="whisker","vert"==constants.plotOrientation?(i[5].bottom=i[4].top,i[5].height=i[5].bottom-i[5].top):(i[5].left=i[4].right,i[5].x=i[4].right,i[5].width=i[5].right-i[5].left)):(i[5]={},i[5].label=n[5],i[5].type="blank")}if(Object.hasOwn(s[t],"outlier")){let e=s[t].outlier.children,o=null,l=null;for(let t=0;t<e.length;t++){let n=e[t].getBoundingClientRect();"vert"==constants.plotOrientation?n.y<a.y?o?(n.y<o.y&&(o.y=n.y),n.top<o.top&&(o.top=n.top),n.bottom>o.bottom&&(o.bottom=n.bottom)):o=this.convertBoundingClientRectToObj(n):l?(n.y<l.y&&(l.y=n.y),n.top<l.top&&(l.top=n.top),n.bottom>l.bottom&&(l.bottom=n.bottom)):l=this.convertBoundingClientRectToObj(n):n.x>a.x?o?(n.x<o.x&&(o.x=n.x),n.left<o.left&&(o.left=n.left),n.right>o.right&&(o.right=n.right)):o=this.convertBoundingClientRectToObj(n):l?(n.x<l.x&&(l.x=n.x),n.left<l.left&&(l.left=n.left),n.right>l.right&&(l.right=n.right)):l=this.convertBoundingClientRectToObj(n)}l?(l.height=l.bottom-l.top,l.width=l.right-l.left,i[0]=this.convertBoundingClientRectToObj(l),i[0].label=n[0],i[0].type="outlier"):(i[0]={},i[0].label=n[0],i[0].type="blank"),o?(o.height=o.bottom-o.top,o.width=o.right-o.left,i[6]=this.convertBoundingClientRectToObj(o),i[6].label=n[6],i[6].type="outlier"):(i[6]={},i[6].label=n[6],i[6].type="blank")}else i[0]={},i[0].label=n[0],i[0].type="blank",i[6]={},i[6].label=n[6],i[6].type="blank";e.push(i)}return constants.debugLevel>5&&console.log("plotBounds",e),e}GetAllSegmentTypes(){return[resources.GetString("lower_outlier"),resources.GetString("min"),resources.GetString("25"),resources.GetString("50"),resources.GetString("75"),resources.GetString("max"),resources.GetString("upper_outlier")]}GetBoxplotSegmentType(t){let e="outlier";return t.includes("geom_crossbar")?e="range":t.includes("GRID")?e="whisker":t.includes("points")&&(e="outlier"),e}GetBoxplotSegmentPoints(t,e){let n=/(?:\d+(?:\.\d*)?|\.\d+)/g,o=[];if("range"==e){let e=t.children[0].getAttribute("points").match(n);o.push(e[0],e[1]),e[0]!=e[2]&&o.push(e[2],e[3])}else if("outlier"==e)o.push(t.getAttribute("x"),t.getAttribute("y"));else{let e=t.getAttribute("points").match(n);"vert"==constants.plotOrientation?e[1]!=e[3]&&o.push(e[0],e[1],e[2],e[3]):e[0]!=e[2]&&o.push(e[0],e[1],e[2],e[3])}return o}convertBoundingClientRectToObj(t){return{top:t.top,right:t.right,bottom:t.bottom,left:t.left,width:t.width,height:t.height,x:t.x,y:t.y}}PlayTones(t){let e=null,n=null;constants.outlierInterval&&clearInterval(constants.outlierInterval),"vert"==constants.plotOrientation?(e=position.x,n=position.y):(e=position.y,n=position.x),"blank"==plot.plotData[e][n].type?t.PlayNull():"outlier"!=plot.plotData[e][n].type?t.playTone():(position.z=0,constants.outlierInterval=setInterval((function(){t.playTone(),position.z+=1,Object.hasOwn(plot.plotData[e][n],"values")?position.z+1>plot.plotData[e][n].values.length&&(clearInterval(constants.outlierInterval),position.z=-1):(clearInterval(constants.outlierInterval),position.z=-1)}),constants.autoPlayOutlierRate))}}class BoxplotRect{rectPadding=15;rectStrokeWidth=4;constructor(){this.x1=0,this.width=0,this.y1=0,this.height=0,this.svgOffsetLeft=constants.svg.getBoundingClientRect().left,this.svgOffsetTop=constants.svg.getBoundingClientRect().top}UpdateRect(){document.getElementById("highlight_rect")&&document.getElementById("highlight_rect").remove();let t=position.x,e=position.y;if("vert"==constants.plotOrientation||(t=position.y,e=position.x),"vert"==constants.plotOrientation&&position.y>-1||"horz"==constants.plotOrientation&&position.x>-1){let n=plot.plotBounds[t][e];"blank"!=n.type&&(this.x1=n.left-this.rectPadding-this.svgOffsetLeft,this.width=n.width+2*this.rectPadding,this.y1=n.top-this.rectPadding-this.svgOffsetTop,this.height=n.height+2*this.rectPadding,constants.debugLevel>5&&(console.log("Point",plot.plotData[t][e].label,"bottom:",n.bottom,"top:",n.top),console.log("x1:",this.x1,"y1:",this.y1,"width:",this.width,"height:",this.height)),this.CreateRectDisplay())}}CreateRectDisplay(){let t=document.createElementNS("http://www.w3.org/2000/svg","rect");t.setAttribute("id","highlight_rect"),t.setAttribute("x",this.x1),t.setAttribute("y",this.y1),t.setAttribute("width",this.width),t.setAttribute("height",this.height),t.setAttribute("stroke",constants.colorSelected),t.setAttribute("stroke-width",this.rectStrokeWidth),t.setAttribute("fill","none"),constants.svg.appendChild(t)}}class HeatMap{constructor(){"elements"in maidr?(this.plots=maidr.elements,constants.hasRect=1):(this.plots=document.querySelectorAll('g[id^="geom_rect"] > rect'),constants.hasRect=0),this.group_labels=this.getGroupLabels(),this.x_labels=this.getXLabels(),this.y_labels=this.getYLabels(),this.title=this.getTitle(),this.plotData=this.getHeatMapData(),this.updateConstants(),this.x_coord=this.plotData[0],this.y_coord=this.plotData[1],this.values=this.plotData[2],this.num_rows=this.plotData[3],this.num_cols=this.plotData[4],this.x_group_label=this.group_labels[0].trim(),this.y_group_label=this.group_labels[1].trim(),this.box_label=this.group_labels[2].trim()}getHeatMapData(){let t=[],e=[],n=[],o=[];if(constants.hasRect){for(let n=0;n<this.plots.length;n++)this.plots[n]&&(t.push(parseFloat(this.plots[n].getAttribute("x"))),e.push(parseFloat(this.plots[n].getAttribute("y"))));t.sort((function(t,e){return t-e})),e.sort((function(t,e){return t-e})).reverse(),n=[...new Set(t)],o=[...new Set(e)]}let s=0,i=0,a=0;"data"in maidr?(s=maidr.data.length,i=maidr.data[0].length):(s=o.length,i=n.length),a=s*i;let l=[];if("data"in maidr)l=[...maidr.data];else{l=Array(s).fill().map((()=>Array(i).fill(0)));let a=3*Math.pow(255,2),h=0;for(var r=0;r<this.plots.length;r++){var p=n.indexOf(t[r]),c=o.indexOf(e[r]);let s=this.getRGBNorm(r);l[c][p]=s,s<a&&(a=s),s>h&&(h=s)}}return[n,o,l,s,i]}updateConstants(){constants.minX=0,constants.maxX=this.plotData[4],constants.minY=this.plotData[2][0][0],constants.maxY=this.plotData[2][0][0];for(let t=0;t<this.plotData[2].length;t++)for(let e=0;e<this.plotData[2][t].length;e++)this.plotData[2][t][e]<constants.minY&&(constants.minY=this.plotData[2][t][e]),this.plotData[2][t][e]>constants.maxY&&(constants.maxY=this.plotData[2][t][e])}getRGBNorm(t){return this.plots[t].getAttribute("fill").slice(4,-1).split(",").map((function(t){return Math.pow(t,2)})).reduce((function(t,e){return t+e}))}getGroupLabels(){let t,e="",n="",o="";return e="title"in maidr?maidr.title:document.querySelector('g[id^="guide.title"] text > tspan').innerHTML,"axes"in maidr?("x"in maidr.axes&&"label"in maidr.axes.x&&(n=maidr.axes.x.label),"y"in maidr.axes&&"label"in maidr.axes.y&&(o=maidr.axes.y.label)):(n=document.querySelector('g[id^="xlab"] text > tspan').innerHTML,o=document.querySelector('g[id^="ylab"] text > tspan').innerHTML),t=[n,o,e],t}getXLabels(){if(!("axes"in maidr)){let t;t=document.querySelectorAll('tspan[dy="10"]');let e=[];for(let n=0;n<t.length;n++)e.push(t[n].innerHTML.trim());return e}if("x"in maidr.axes&&"format"in maidr.axes.x)return maidr.axes.x.format}getYLabels(){if(!("axes"in maidr)){let t,e=[];t=document.querySelectorAll('tspan[id^="GRID.text.19.1"]');for(let n=0;n<t.length;n++)e.push(t[n].innerHTML.trim());return e.reverse()}if("y"in maidr.axes&&"format"in maidr.axes.y)return maidr.axes.y.format}getTitle(){if("title"in maidr)return maidr.title;{let t=document.querySelector('g[id^="layout::title"] text > tspan').innerHTML;return constants.manualData&&void 0!==t&&null!=typeof t?t:""}}}class HeatMapRect{constructor(){constants.hasRect&&(this.x=plot.x_coord[0],this.y=plot.y_coord[0],this.rectStrokeWidth=4,this.height=Math.abs(plot.y_coord[1]-plot.y_coord[0]))}UpdateRect(){this.x=plot.x_coord[position.x],this.y=plot.y_coord[position.y]}UpdateRectDisplay(){this.UpdateRect(),document.getElementById("highlight_rect")&&document.getElementById("highlight_rect").remove();var t=document.createElementNS("http://www.w3.org/2000/svg","rect");t.setAttribute("id","highlight_rect"),t.setAttribute("x",this.x),t.setAttribute("y",constants.svg.getBoundingClientRect().height-this.height-this.y),t.setAttribute("width",this.height),t.setAttribute("height",this.height),t.setAttribute("stroke",constants.colorSelected),t.setAttribute("stroke-width",this.rectStrokeWidth),t.setAttribute("fill","none"),constants.svg.appendChild(t)}}document.addEventListener("DOMContentLoaded",(function(t){}));class ScatterPlot{constructor(){"point_elements"in maidr?this.plotPoints=maidr.point_elements:this.plotPoints=document.querySelectorAll("#"+constants.plotId.replaceAll(".","\\.")+" > use"),this.svgPointsX=this.GetSvgPointCoords()[0],this.svgPointsY=this.GetSvgPointCoords()[1],this.x=this.GetPointValues()[0],this.y=this.GetPointValues()[1],this.points_count=this.GetPointValues()[2],this.max_count=this.GetPointValues()[3],constants.manualData?this.plotLine=maidr.smooth_elements:this.plotLine=document.querySelectorAll("#"+"GRID.polyline.13.1".replaceAll(".","\\.")+" > polyline")[0],this.svgLineX=this.GetSvgLineCoords()[0],this.svgLineY=this.GetSvgLineCoords()[1],this.curveX=this.GetSmoothCurvePoints()[0],this.curvePoints=this.GetSmoothCurvePoints()[1],this.curveMinY=Math.min(...this.curvePoints),this.curveMaxY=Math.max(...this.curvePoints),this.gradient=this.GetGradient(),this.x_group_label="",this.y_group_label="",this.title="","undefined"!=typeof maidr&&("axes"in maidr&&("x"in maidr.axes&&(this.x_group_label=maidr.axes.x.label),"y"in maidr.axes&&(this.y_group_label=maidr.axes.y.label)),"title"in maidr&&(this.title=maidr.title))}GetSvgPointCoords(){let t=new Map;for(let e=0;e<this.plotPoints.length;e++){let n=parseFloat(this.plotPoints[e].getAttribute("x")),o=parseFloat(this.plotPoints[e].getAttribute("y"));t.has(n)?t.get(n).add(o):t.set(n,new Set([o]))}t=new Map([...t].sort((function(t,e){return t[0]-e[0]}))),t.forEach((function(e,n){t[n]=Array.from(e).sort((function(t,e){return t-e}))}));let e=[...t.keys()],n=[];for(let o=0;o<e.length;o++)n.push(t[e[o]]);return[e,n]}GetPointValues(){let t=new Map,e=[],n=[];for(let o=0;o<maidr.data.data_point_layer.length;o++){let s=maidr.data.data_point_layer[o].x,i=maidr.data.data_point_layer[o].y;if(e.push(s),n.push(i),t.has(s))if(t.get(s).has(i)){let e=t.get(s);e.set(i,e.get(i)+1)}else t.get(s).set(i,1);else t.set(s,new Map([[i,1]]))}constants.minX=0,constants.maxX=[...new Set(e)].length,constants.minY=Math.min(...n),constants.maxY=Math.max(...n),t=new Map([...t].sort((function(t,e){return t[0]-e[0]}))),t.forEach((function(e,n){t[n]=Array.from(e).sort((function(t,e){return t[0]-e[0]}))}));let o=[],s=[],i=[];for(const[e,n]of t){o.push(e);let t=[],a=[];for(const[e,o]of n)t.push(e),a.push(o);s.push(t.sort()),i.push(a)}let a=Math.max(...i.map((t=>Math.max(...t))));return[o,s,i,a]}PlayTones(t){constants.sepPlayId&&constants.KillSepPlay(),1==constants.layer?(position.z=0,constants.sepPlayId=setInterval((function(){t.playTone(),position.z+=1,position.z+1>plot.y[position.x].length&&(constants.KillSepPlay(),position.z=-1)}),"sep"==constants.sonifMode?constants.autoPlayPointsRate:0)):2==constants.layer&&t.playTone()}GetSvgLineCoords(){let t=this.plotLine.getAttribute("points").split(" "),e=[],n=[];for(let o=0;o<t.length;o++){let s=t[o].split(",");e.push(parseFloat(s[0])),n.push(parseFloat(s[1]))}return[e,n]}GetSmoothCurvePoints(){let t=[],e=[];for(let n=0;n<maidr.data.data_smooth_layer.length;n++)t.push(maidr.data.data_smooth_layer[n].x),e.push(maidr.data.data_smooth_layer[n].y);return[t,e]}GetGradient(){let t=[];for(let e=0;e<this.curvePoints.length-1;e++){let n=Math.abs((this.curvePoints[e+1]-this.curvePoints[e])/(this.curveX[e+1]-this.curveX[e])).toFixed(3);t.push(n)}return t.push("end"),t}}class Layer0Point{constructor(){this.x=plot.svgPointsX[0],this.y=plot.svgPointsY[0],this.strokeWidth=1.35}async UpdatePoints(){await this.ClearPoints(),this.x=plot.svgPointsX[position.x],this.y=plot.svgPointsY[position.x]}async PrintPoints(){await this.ClearPoints(),await this.UpdatePoints();for(let e=0;e<this.y.length;e++){const n="http://www.w3.org/2000/svg";var t=document.createElementNS(n,"circle");t.setAttribute("class","highlight_point"),t.setAttribute("cx",this.x),t.setAttribute("cy",constants.svg.getBoundingClientRect().height-this.y[e]),t.setAttribute("r",3.95),t.setAttribute("stroke",constants.colorSelected),t.setAttribute("stroke-width",this.strokeWidth),t.setAttribute("fill",constants.colorSelected),constants.svg.appendChild(t)}}async ClearPoints(){document.getElementById("highlight_point")&&document.getElementById("highlight_point").remove();let t=document.getElementsByClassName("highlight_point");for(let e=0;e<t.length;e++)document.getElementsByClassName("highlight_point")[e].remove()}UpdatePointDisplay(){this.ClearPoints(),this.UpdatePoints(),this.PrintPoints()}}class Layer1Point{constructor(){this.x=plot.svgLineX[0],this.y=plot.svgLineY[0],this.strokeWidth=1.35}async UpdatePoints(){await this.ClearPoints(),this.x=plot.svgLineX[positionL1.x],this.y=plot.svgLineY[positionL1.x]}async PrintPoints(){await this.ClearPoints(),await this.UpdatePoints();var t=document.createElementNS("http://www.w3.org/2000/svg","circle");t.setAttribute("id","highlight_point"),t.setAttribute("cx",this.x),t.setAttribute("cy",constants.svg.getBoundingClientRect().height-this.y),t.setAttribute("r",3.95),t.setAttribute("stroke",constants.colorSelected),t.setAttribute("stroke-width",this.strokeWidth),t.setAttribute("fill",constants.colorSelected),constants.svg.appendChild(t)}async ClearPoints(){let t=document.getElementsByClassName("highlight_point");for(let e=0;e<t.length;e++)document.getElementsByClassName("highlight_point")[e].remove();document.getElementById("highlight_point")&&document.getElementById("highlight_point").remove()}UpdatePointDisplay(){this.ClearPoints(),this.UpdatePoints(),this.PrintPoints()}}document.addEventListener("DOMContentLoaded",(function(t){if(window.constants=new Constants,window.resources=new Resources,window.menu=new Menu,window.tracker=new Tracker,document.getElementById("download_data_trigger")&&document.getElementById("download_data_trigger").addEventListener("click",(function(t){tracker.DownloadTrackerData()})),document.getElementById(constants.svg_container_id)){constants.PrepChartHelperComponents(),window.review=new Review,window.display=new Display,constants.debugLevel>5&&setTimeout((function(){constants.svg.focus()}),100),constants.svg_container&&constants.svg_container.addEventListener("keydown",(function(t){72==t.which&&menu.Toggle(!0)}));let t=document.querySelectorAll("#close_menu, #menu .close");for(let e=0;e<t.length;e++)t[e].addEventListener("click",(function(t){menu.Toggle(!1)}));document.getElementById("save_and_close_menu").addEventListener("click",(function(t){menu.SaveData(),menu.Toggle(!1)})),document.getElementById("menu").addEventListener("keydown",(function(t){27==t.which&&(menu.Toggle(!1),svg.focus())}));let e=document.querySelectorAll("#"+constants.svg_container_id+" > svg, #"+constants.braille_input_id);for(let t=0;t<e.length;t++)e[t].addEventListener("focus",(function(n){constants.nonMenuFocus=e[t]}));document.addEventListener("keydown",(function(t){constants.isTracking&&(121==t.which||plot&&tracker.LogEvent(t)),(constants.isMac?91==t.which||93==t.which:17==t.which)&&constants.KillAutoplay(),82!=t.which||t.ctrlKey||t.shiftKey||t.altKey||(t.preventDefault(),constants.review_container.classList.contains("hidden")?review.ToggleReviewMode(!0):review.ToggleReviewMode(!1))}))}document.addEventListener("keydown",(function(t){(116==t.which&&(constants.isMac?t.metaKey:t.ctrlKey)||82==t.which&&t.shiftKey&&(constants.isMac?t.metaKey:t.ctrlKey))&&(t.preventDefault(),tracker.Delete(),location.reload(!0))}))})),document.addEventListener("DOMContentLoaded",(function(t){if("undefined"!=typeof maidr&&"type"in maidr&&(constants.chartType=maidr.type),void 0!==constants.chartType)if("barplot"==constants.chartType){window.position=new Position(-1,-1),window.plot=new BarChart;let l=new Audio,r="",p=0,c=0,h=!1;constants.svg_container.addEventListener("keydown",(function(t){let o=!1,s=!1;39===t.which&&((constants.isMac?t.metaKey:t.ctrlKey)?t.shiftKey?(position.x-=1,i("right",position.x,plot.bars.length)):(position.x=plot.bars.length-1,o=!0,s=e()):t.altKey&&t.shiftKey&&position.x!=plot.bars.length-1?(p=position.x,i("reverse-right",plot.bars.length,position.x)):(position.x+=1,o=!0,s=e())),37===t.which&&((constants.isMac?t.metaKey:t.ctrlKey)?t.shiftKey?(position.x+=1,i("left",position.x,-1)):(position.x=0,o=!0,s=e()):t.altKey&&t.shiftKey&&0!=position.x?(p=position.x,i("reverse-left",-1,position.x)):(position.x+=-1,o=!0,s=e())),o&&!s&&n(),s&&l.playEnd()})),constants.brailleInput.addEventListener("keydown",(function(t){let n=!1,o=!1;9==t.which||(39==t.which?(t.preventDefault(),t.target.selectionStart>t.target.value.length-2||((constants.isMac?t.metaKey:t.ctrlKey)?t.shiftKey?(position.x-=1,i("right",position.x,plot.bars.length)):(position.x=plot.bars.length-1,n=!0,o=e()):t.altKey&&t.shiftKey&&position.x!=plot.bars.length-1?(p=position.x,i("reverse-right",plot.bars.length,position.x)):(position.x+=1,n=!0,o=e()))):37==t.which?(t.preventDefault(),(constants.isMac?t.metaKey:t.ctrlKey)?t.shiftKey?(position.x+=1,i("left",position.x,-1)):(position.x=0,n=!0,o=e()):t.altKey&&t.shiftKey&&0!=position.x?(p=position.x,i("reverse-left",-1,position.x)):(position.x+=-1,n=!0,o=e())):t.preventDefault()),constants.brailleInput.addEventListener("focusout",(function(t){display.toggleBrailleMode("off")})),n&&!o&&s(),o&&l.playEnd()}));let d=[constants.svg_container,constants.brailleInput];for(let u=0;u<d.length;u++)d[u].addEventListener("keydown",(function(t){if(66==t.which&&(display.toggleBrailleMode(),t.preventDefault()),84==t.which){let t=window.performance.now()-c;(!h||t>constants.keypressInterval)&&display.toggleTextMode()}83==t.which&&display.toggleSonificationMode(),32===t.which&&n()}));function e(){let t=!1;return constants.hasRect?(position.x<0&&(position.x=0,t=!0),position.x>plot.bars.length-1&&(position.x=plot.bars.length-1,t=!0),t):t}function n(){constants.showDisplay&&display.displayValues(plot),constants.showRect&&constants.hasRect&&plot.Select(),"off"!=constants.sonifMode&&l.playTone()}function o(){constants.showDisplayInAutoplay&&display.displayValues(plot),constants.showRect&&constants.hasRect&&plot.Select(),"off"!=constants.sonifMode&&l.playTone(),"off"!=constants.brailleMode&&display.UpdateBraillePos(plot)}function s(){constants.showDisplayInBraille&&display.displayValues(plot),constants.showRect&&constants.hasRect&&plot.Select(),"off"!=constants.sonifMode&&l.playTone(),display.UpdateBraillePos(plot)}function i(t,n,s){r=t;let i=1;"left"!=t&&"reverse-right"!=t||(i=-1),null!=constants.autoplayId&&constants.KillAutoplay(),"reverse-right"!=t&&"reverse-left"!=t||(position.x=n),constants.autoplayId=setInterval((function(){position.x+=i,position.x<0||plot.bars.length-1<position.x?(constants.KillAutoplay(),e()):position.x==s?(constants.KillAutoplay(),o()):o()}),constants.autoPlayRate)}document.addEventListener("keydown",(function(t){if((constants.isMac?t.metaKey:t.ctrlKey)&&(36==t.which?(position.x=0,s()):35==t.which&&(position.x=plot.bars.length-1,s())),h)if(88==t.which){let t=window.performance.now()-c;h&&t<=constants.keypressInterval&&display.displayXLabel(plot),h=!1}else if(89==t.which){let t=window.performance.now()-c;h&&t<=constants.keypressInterval&&display.displayYLabel(plot),h=!1}else if(84==t.which){let t=window.performance.now()-c;h&&t<=constants.keypressInterval&&display.displayTitle(plot),h=!1}else 76==t.which?(c=window.performance.now(),h=!0):h=!1;76==t.which&&(c=window.performance.now(),h=!0),190==t.which&&(constants.SpeedUp(),null!=constants.autoplayId&&(constants.KillAutoplay(),i("reverse-left"==r?"right":"reverse-right"==r?"left":r,position.x,p))),188==t.which&&(constants.SpeedDown(),null!=constants.autoplayId&&(constants.KillAutoplay(),i("reverse-left"==r?"right":"reverse-right"==r?"left":r,position.x,p)))}))}else if("boxplot"==constants.chartType){constants.plotId="geom_boxplot.gTree.78.1",window.plot=new BoxPlot,constants.chartType="boxplot","vert"==constants.plotOrientation?window.position=new Position(0,plot.plotData[0].length-1):window.position=new Position(-1,plot.plotData.length);let y=new BoxplotRect,g=new Audio,m="",f=0,x=0,v=0,b=!1;constants.svg_container.addEventListener("keydown",(function(t){let o=!1,s=!1;if(39===t.which&&((constants.isMac?t.metaKey:t.ctrlKey)?t.shiftKey?"vert"==constants.plotOrientation?i("right",position.x,plot.plotData.length-1):i("right",position.x,plot.plotData[position.y].length):(s=e(),"vert"==constants.plotOrientation?position.x=plot.plotData.length-1:position.x=plot.plotData[position.y].length-1,o=!0,s=e()):"vert"==constants.plotOrientation?t.altKey&&t.shiftKey&&plot.plotData.length-1!=position.x?(f=position.y,i("reverse-right",plot.plotData.length-1,position.x)):(-1==position.x&&position.y==plot.plotData[position.x].length&&(position.y-=1),position.x+=1,o=!0,s=e()):t.altKey&&t.shiftKey&&plot.plotData[position.y].length-1!=position.x?(x=position.x,i("reverse-right",plot.plotData[position.y].length-1,position.x)):(-1==position.x&&position.y==plot.plotData.length&&(position.y-=1),position.x+=1,o=!0,s=e()),constants.navigation=1),37===t.which&&((constants.isMac?t.metaKey:t.ctrlKey)?t.shiftKey?i("left",position.x,-1):(position.x=0,o=!0,s=e()):t.altKey&&t.shiftKey&&position.x>0?("vert"==constants.plotOrientation?f=position.y:x=position.x,i("reverse-left",0,position.x)):(position.x+=-1,o=!0,s=e()),constants.navigation=1),38===t.which){position.y;(constants.isMac?t.metaKey:t.ctrlKey)?t.shiftKey?"vert"==constants.plotOrientation?i("up",position.y,plot.plotData[position.x].length):i("up",position.y,plot.plotData.length):("vert"==constants.plotOrientation?position.y=plot.plotData[position.x].length-1:position.y=plot.plotData.length-1,o=!0,s=e()):"vert"==constants.plotOrientation?t.altKey&&t.shiftKey&&position.y!=plot.plotData[position.x].length-1?(f=position.y,i("reverse-up",plot.plotData[position.x].length-1,position.y)):(position.y+=1,o=!0,s=e()):t.altKey&&t.shiftKey&&position.y!=plot.plotData.length-1?(x=position.x,i("reverse-up",plot.plotData.length-1,position.y)):(position.y+=1,o=!0,s=e()),constants.navigation=0}if(40===t.which){position.y;(constants.isMac?t.metaKey:t.ctrlKey)?t.shiftKey?i("down",position.y,-1):(position.y=0,o=!0,s=e()):t.altKey&&t.shiftKey&&0!=position.y?("vert"==constants.plotOrientation?f=position.y:x=position.x,i("reverse-down",0,position.y)):("vert"==constants.plotOrientation?-1==position.x&&position.y==plot.plotData[position.x].length&&(position.x+=1):-1==position.x&&position.y==plot.plotData.length&&(position.x+=1),position.y+=-1,o=!0,s=e()),constants.navigation=0}o&&!s&&n(),s&&g.playEnd()})),constants.brailleInput.addEventListener("keydown",(function(t){let n=!1,o=!1,a=!1;if(9==t.which);else if(39==t.which)t.preventDefault(),(constants.isMac?t.metaKey:t.ctrlKey)?t.shiftKey?"vert"==constants.plotOrientation?i("right",position.x,plot.plotData.length-1):i("right",position.x,plot.plotData[position.y].length):("vert"==constants.plotOrientation?position.x=plot.plotData.length-1:position.x=plot.plotData[position.y].length-1,n=!0,a=e()):"vert"==constants.plotOrientation?t.altKey&&t.shiftKey&&plot.plotData.length-1!=position.x?(f=position.y,i("reverse-right",plot.plotData.length-1,position.x)):(-1==position.x&&position.y==plot.plotData[position.x].length&&(position.y-=1),position.x+=1,n=!0,a=e()):t.altKey&&t.shiftKey&&plot.plotData[position.y].length-1!=position.x?(x=position.x,i("reverse-right",plot.plotData[position.y].length-1,position.x)):(-1==position.x&&position.y==plot.plotData.length&&(position.y-=1),position.x+=1,n=!0,a=e()),o=!0,constants.navigation=1;else if(37==t.which)t.preventDefault(),(constants.isMac?t.metaKey:t.ctrlKey)?t.shiftKey?i("left",position.x,-1):(position.x=0,n=!0,a=e()):t.altKey&&t.shiftKey&&position.x>0?("vert"==constants.plotOrientation?f=position.y:x=position.x,i("reverse-left",0,position.x)):(position.x+=-1,n=!0,a=e()),o=!0,constants.navigation=1;else if(38===t.which){position.y;(constants.isMac?t.metaKey:t.ctrlKey)?t.shiftKey?"vert"==constants.plotOrientation?(position.x<0&&(position.x=0),i("up",position.y,plot.plotData[position.x].length)):i("up",position.y,plot.plotData.length):"vert"==constants.plotOrientation?(position.y=plot.plotData[position.x].length-1,n=!0):(position.y=plot.plotData.length-1,n=!0):"vert"==constants.plotOrientation?t.altKey&&t.shiftKey&&position.y!=plot.plotData[position.x].length-1?(lasY=position.y,i("reverse-up",plot.plotData[position.x].length-1,position.y)):(position.y+=1,n=!0,a=e()):t.altKey&&t.shiftKey&&position.y!=plot.plotData.length-1?(x=position.x,i("reverse-up",plot.plotData.length-1,position.y)):(position.y+=1,n=!0,a=e()),"vert"==constants.plotOrientation||(o=!0),constants.navigation=0}else if(40===t.which){position.y;(constants.isMac?t.metaKey:t.ctrlKey)?t.shiftKey?i("down",position.y,-1):(position.y=0,n=!0,a=e()):t.altKey&&t.shiftKey&&0!=position.y?("vert"==constants.plotOrientation?f=position.y:x=position.x,i("reverse-down",0,position.y)):("vert"==constants.plotOrientation?-1==position.x&&position.y==plot.plotData[position.x].length&&(position.x+=1):-1==position.x&&position.y==plot.plotData.length&&(position.x+=1),position.y+=-1,n=!0,a=e()),constants.navigation=0,"vert"==constants.plotOrientation||(o=!0),constants.navigation=0}else t.preventDefault();n&&!a&&(o&&display.SetBraille(plot),setTimeout(s,50)),a&&g.playEnd(),constants.brailleInput.addEventListener("focusout",(function(t){display.toggleBrailleMode("off")}))}));let w=[constants.svg_container,constants.brailleInput];for(let _=0;_<w.length;_++)w[_].addEventListener("keydown",(function(t){if(66==t.which&&(display.toggleBrailleMode(),t.preventDefault()),84==t.which){let t=window.performance.now()-v;(!b||t>constants.keypressInterval)&&display.toggleTextMode()}83==t.which&&display.toggleSonificationMode(),32===t.which&&n()}));function n(){constants.showDisplay&&display.displayValues(plot),constants.showRect&&constants.hasRect&&y.UpdateRect(),"off"!=constants.sonifMode&&plot.PlayTones(g)}function o(){constants.showDisplayInAutoplay&&display.displayValues(plot),constants.showRect&&constants.hasRect&&y.UpdateRect(),"off"!=constants.sonifMode&&plot.PlayTones(g),"off"!=constants.brailleMode&&display.UpdateBraillePos(plot)}function s(){constants.showDisplayInBraille&&display.displayValues(plot),constants.showRect&&constants.hasRect&&y.UpdateRect(),"off"!=constants.sonifMode&&plot.PlayTones(g),display.UpdateBraillePos(plot)}function e(){let t=!1;return"vert"==constants.plotOrientation?(position.y<0&&(position.y=0,t=!0),position.x<0&&(position.x=0,t=!0),position.x>plot.plotData.length-1&&(position.x=plot.plotData.length-1,t=!0),position.y>plot.plotData[position.x].length-1&&(position.y=plot.plotData[position.x].length-1,t=!0)):(position.x<0&&(position.x=0,t=!0),position.y<0&&(position.y=0,t=!0),position.y>plot.plotData.length-1&&(position.y=plot.plotData.length-1,t=!0),position.x>plot.plotData[position.y].length-1&&(position.x=plot.plotData[position.y].length-1,t=!0)),t}function i(t,e,n){m=t;let s=1;"left"!=t&&"down"!=t&&"reverse-right"!=t&&"reverse-up"!=t||(s=-1),null!=constants.autoplayId&&constants.KillAutoplay(),"reverse-left"==t||"reverse-right"==t?position.x=e:"reverse-up"!=t&&"reverse-down"!=t||(position.y=e),constants.debugLevel>0&&console.log("starting autoplay",t),o(),constants.autoplayId=setInterval((function(){let e=!1;"left"==t||"right"==t||"up"==t||"down"==t?(position.x<1&&"left"==t||"vert"==constants.plotOrientation&&"up"==t&&position.y>plot.plotData[position.x].length-2||"horz"==constants.plotOrientation&&"up"==t&&position.y>plot.plotData.length-2||"horz"==constants.plotOrientation&&"right"==t&&position.x>plot.plotData[position.y].length-2||"vert"==constants.plotOrientation&&"right"==t&&position.x>plot.plotData.length-2||"horz"==constants.plotOrientation&&"down"==t&&position.y<1||"vert"==constants.plotOrientation&&"down"==t&&position.y<1)&&(e=!0):("reverse-left"==t&&position.x>=n||"reverse-right"==t&&position.x<=n||"reverse-up"==t&&position.y<=n||"reverse-down"==t&&position.y>=n)&&(e=!0),e?constants.KillAutoplay():("left"==t||"right"==t||"reverse-left"==t||"reverse-right"==t?position.x+=s:position.y+=s,o()),constants.debugLevel>5&&console.log("autoplay pos",position)}),constants.autoPlayRate)}document.addEventListener("keydown",(function(t){if((constants.isMac?t.metaKey:t.ctrlKey)&&(36==t.which?(position.x=0,position.y=plot.plotData.length-1,s()):35==t.which&&(position.x=plot.plotData[0].length-1,position.y=0,s())),b)if(88==t.which){let t=window.performance.now()-v;b&&t<=constants.keypressInterval&&display.displayXLabel(plot),b=!1}else if(89==t.which){let t=window.performance.now()-v;b&&t<=constants.keypressInterval&&display.displayYLabel(plot),b=!1}else if(84==t.which){let t=window.performance.now()-v;b&&t<=constants.keypressInterval&&display.displayTitle(plot),b=!1}else 76==t.which?(v=window.performance.now(),b=!0):b=!1;76==t.which&&(v=window.performance.now(),b=!0),190==t.which&&(constants.SpeedUp(),null!=constants.autoplayId&&(constants.KillAutoplay(),"reverse-left"==m?"vert"==constants.plotOrientation?i("right",position.y,f):i("right",position.x,x):"reverse-right"==m?"vert"==constants.plotOrientation?i("left",position.y,f):i("left",position.x,x):"reverse-up"==m?"vert"==constants.plotOrientation?i("down",position.y,f):i("down",position.x,x):"reverse-down"==m?"vert"==constants.plotOrientation?i("up",position.y,f):i("up",position.x,x):"vert"==constants.plotOrientation?i(m,position.y,f):i(m,position.x,x))),188==t.which&&(constants.SpeedDown(),null!=constants.autoplayId&&(constants.KillAutoplay(),"reverse-left"==m?"vert"==constants.plotOrientation?i("right",position.y,f):i("right",position.x,x):"reverse-right"==m?"vert"==constants.plotOrientation?i("left",position.y,f):i("left",position.x,x):"reverse-up"==m?"vert"==constants.plotOrientation?i("down",position.y,f):i("down",position.x,x):"reverse-down"==m?"vert"==constants.plotOrientation?i("up",position.y,f):i("up",position.x,x):"vert"==constants.plotOrientation?i(m,position.y,f):i(m,position.x,x)))}))}else if("heatmap"==constants.chartType){constants.plotId="geom_rect.rect.2.1",window.position=new Position(-1,-1),window.plot=new HeatMap,constants.chartType="heatmap";let M=new HeatMapRect,D=new Audio,S="",L=0,O=0,E=!1;constants.svg_container.addEventListener("keydown",(function(t){let o=!1,s=!1;39===t.which&&((constants.isMac?t.metaKey:t.ctrlKey)?t.shiftKey?(position.x-=1,i("right",position.x,plot.num_cols)):(position.x=plot.num_cols-1,o=!0):t.altKey&&t.shiftKey&&position.x!=plot.num_cols-1?(L=position.x,i("reverse-right",plot.num_cols,position.x)):(-1==position.x&&-1==position.y&&(position.y+=1),position.x+=1,o=!0,s=e()),constants.navigation=1),37===t.which&&((constants.isMac?t.metaKey:t.ctrlKey)?t.shiftKey?(position.x+=1,i("left",position.x,-1)):(position.x=0,o=!0):t.altKey&&t.shiftKey&&0!=position.x?(L=position.x,i("reverse-left",-1,position.x)):(position.x-=1,o=!0,s=e()),constants.navigation=1),38===t.which&&((constants.isMac?t.metaKey:t.ctrlKey)?t.shiftKey?(position.y+=1,i("up",position.y,-1)):(position.y=0,o=!0):t.altKey&&t.shiftKey&&0!=position.y?(L=position.x,i("reverse-up",-1,position.y)):(position.y-=1,o=!0,s=e()),constants.navigation=0),40===t.which&&((constants.isMac?t.metaKey:t.ctrlKey)?t.shiftKey?(position.y-=1,i("down",position.y,plot.num_rows)):(position.y=plot.num_rows-1,o=!0):t.altKey&&t.shiftKey&&position.y!=plot.num_rows-1?(L=position.x,i("reverse-down",plot.num_rows,position.y)):(-1==position.x&&-1==position.y&&(position.x+=1),position.y+=1,o=!0,s=e()),constants.navigation=0),o&&!s&&n(),s&&D.playEnd()})),constants.brailleInput.addEventListener("keydown",(function(t){let n=!1,o=!1;if(9==t.which);else if(39==t.which)if(t.target.selectionStart>t.target.value.length-3||"⠳"==t.target.value.substring(t.target.selectionStart+1,t.target.selectionStart+2))t.preventDefault();else{(constants.isMac?t.metaKey:t.ctrlKey)?(-1==position.x&&-1==position.y&&(position.x+=1,position.y+=1),t.shiftKey?(position.x-=1,i("right",position.x,plot.num_cols)):(position.x=plot.num_cols-1,n=!0)):t.altKey&&t.shiftKey&&position.x!=plot.num_cols-1?(L=position.x,i("reverse-right",plot.num_cols,position.x)):(-1==position.x&&-1==position.y&&(position.y+=1),position.x+=1,n=!0,o=e());let s=position.y*(plot.num_cols+1)+position.x;t.target.setSelectionRange(s,s),t.preventDefault(),constants.navigation=1}else if(37==t.which)if(0==t.target.selectionStart||"⠳"==t.target.value.substring(t.target.selectionStart-1,t.target.selectionStart))t.preventDefault();else{(constants.isMac?t.metaKey:t.ctrlKey)?t.shiftKey?(position.x+=1,i("left",position.x,-1)):(position.x=0,n=!0):t.altKey&&t.shiftKey&&0!=position.x?(L=position.x,i("reverse-left",-1,position.x)):(position.x+=-1,n=!0,o=e());let s=position.y*(plot.num_cols+1)+position.x;t.target.setSelectionRange(s,s),t.preventDefault(),constants.navigation=1}else if(40==t.which)if(position.y+1==plot.num_rows)t.preventDefault();else{(constants.isMac?t.metaKey:t.ctrlKey)?(-1==position.x&&-1==position.y&&(position.x+=1,position.y+=1),t.shiftKey?(position.y-=1,i("down",position.y,plot.num_rows)):(position.y=plot.num_rows-1,n=!0)):t.altKey&&t.shiftKey&&position.y!=plot.num_rows-1?(L=position.x,i("reverse-down",plot.num_rows,position.y)):(-1==position.x&&-1==position.y&&(position.x+=1),position.y+=1,n=!0,o=e());let s=position.y*(plot.num_cols+1)+position.x;t.target.setSelectionRange(s,s),t.preventDefault(),constants.navigation=0}else if(38==t.which)if(t.target.selectionStart-plot.num_cols-1<0)t.preventDefault();else{(constants.isMac?t.metaKey:t.ctrlKey)?t.shiftKey?(position.y+=1,i("up",position.y,-1)):(position.y=0,n=!0):t.altKey&&t.shiftKey&&0!=position.y?(L=position.x,i("reverse-up",-1,position.y)):(position.y+=-1,n=!0,o=e());let s=position.y*(plot.num_cols+1)+position.x;t.target.setSelectionRange(s,s),t.preventDefault(),constants.navigation=0}else t.preventDefault();constants.brailleInput.addEventListener("focusout",(function(t){display.toggleBrailleMode("off")})),n&&!o&&s(),o&&D.playEnd()}));let I=[constants.svg_container,constants.brailleInput];for(let T=0;T<I.length;T++)I[T].addEventListener("keydown",(function(t){if(66==t.which&&(display.toggleBrailleMode(),t.preventDefault()),84==t.which){let t=window.performance.now()-O;(!E||t>constants.keypressInterval)&&display.toggleTextMode()}83==t.which&&display.toggleSonificationMode(),32===t.which&&n()}));function e(){let t=!1;return position.x<0&&(position.x=0,t=!0),position.x>plot.num_cols-1&&(position.x=plot.num_cols-1,t=!0),position.y<0&&(position.y=0,t=!0),position.y>plot.num_rows-1&&(position.y=plot.num_rows-1,t=!0),t}function n(){constants.showDisplay&&display.displayValues(plot),constants.showRect&&constants.hasRect&&M.UpdateRectDisplay(),"off"!=constants.sonifMode&&D.playTone()}function o(){constants.showDisplayInAutoplay&&display.displayValues(plot),constants.showRect&&constants.hasRect&&M.UpdateRectDisplay(),"off"!=constants.sonifMode&&D.playTone(),"off"!=constants.brailleMode&&display.UpdateBraillePos(plot)}function s(){constants.showDisplayInBraille&&display.displayValues(plot),constants.showRect&&constants.hasRect&&M.UpdateRectDisplay(),"off"!=constants.sonifMode&&D.playTone(),display.UpdateBraillePos(plot)}function i(t,n,s){S=t;let i=1;"left"!=t&&"up"!=t&&"reverse-right"!=t&&"reverse-down"!=t||(i=-1),null!=constants.autoplayId&&constants.KillAutoplay(),"reverse-left"==t||"reverse-right"==t?position.x=n:"reverse-up"!=t&&"reverse-down"!=t||(position.y=n),constants.autoplayId=setInterval((function(){"left"==t||"right"==t||"reverse-left"==t||"reverse-right"==t?(position.x+=i,position.x<0||plot.num_cols-1<position.x?(constants.KillAutoplay(),e()):position.x==s?(constants.KillAutoplay(),o()):o()):(position.y+=i,position.y<0||plot.num_rows-1<position.y?(constants.KillAutoplay(),e()):position.y==s?(constants.KillAutoplay(),o()):o())}),constants.autoPlayRate)}document.addEventListener("keydown",(function(t){if((constants.isMac?t.metaKey:t.ctrlKey)&&(36==t.which?(position.x=0,position.y=0,s()):35==t.which&&(position.x=plot.num_cols-1,position.y=plot.num_rows-1,s())),E)if(88==t.which){let t=window.performance.now()-O;E&&t<=constants.keypressInterval&&display.displayXLabel(plot),E=!1}else if(89==t.which){let t=window.performance.now()-O;E&&t<=constants.keypressInterval&&display.displayYLabel(plot),E=!1}else if(84==t.which){let t=window.performance.now()-O;E&&t<=constants.keypressInterval&&display.displayTitle(plot),E=!1}else if(70==t.which){let t=window.performance.now()-O;E&&t<=constants.keypressInterval&&display.displayFill(plot),E=!1}else 76==t.which?(O=window.performance.now(),E=!0):E=!1;76==t.which&&(O=window.performance.now(),E=!0),190==t.which&&(constants.SpeedUp(),null!=constants.autoplayId&&(constants.KillAutoplay(),i("reverse-left"==S?"right":"reverse-right"==S?"left":"reverse-up"==S?"down":"reverse-down"==S?"up":S,position.x,L))),188==t.which&&(constants.SpeedDown(),null!=constants.autoplayId&&(constants.KillAutoplay(),i("reverse-left"==S?"right":"reverse-right"==S?"left":"reverse-up"==S?"down":"reverse-down"==S?"up":S,position.x,L)))}))}else if("scatterplot"==constants.chartType||constants.chartType.includes("scatterplot")){constants.plotId="geom_point.points.12.1",window.position=new Position(-1,-1),window.plot=new ScatterPlot,constants.chartType="scatterplot";let P=new Audio,K=new Layer0Point,R=new Layer1Point,A="",C=0,B=0,N=0,k=!1;window.positionL1=new Position(B,B),constants.svg_container.addEventListener("keydown",(function(t){let o=!1,s=!1;1==constants.layer?(39===t.which&&((constants.isMac?t.metaKey:t.ctrlKey)?t.shiftKey?(position.x-=1,i("outward_right",position.x,plot.x.length)):(position.x=plot.x.length-1,o=!0,s=e()):t.altKey&&t.shiftKey&&position.x!=plot.x.length-1?(C=position.x,i("inward_right",plot.x.length,position.x)):(position.x+=1,o=!0,s=e())),37===t.which&&((constants.isMac?t.metaKey:t.ctrlKey)?t.shiftKey?(position.x+=1,i("outward_left",position.x,-1)):(position.x=0,o=!0,s=e()):t.altKey&&t.shiftKey&&0!=position.x?(C=position.x,i("inward_left",-1,position.x)):(position.x-=1,o=!0,s=e()))):2==constants.layer&&(positionL1.x=B,39==t.which&&t.shiftKey&&((constants.isMac?t.metaKey:t.ctrlKey)&&"off"!=constants.sonifMode?a("outward_right"):t.altKey&&"off"!=constants.sonifMode&&a("inward_right")),37==t.which&&t.shiftKey&&((constants.isMac?t.metaKey:t.ctrlKey)&&"off"!=constants.sonifMode?a("outward_left"):t.altKey&&"off"!=constants.sonifMode&&a("inward_left"))),o&&1==constants.layer&&!s&&n(),s&&P.playEnd()})),constants.brailleInput.addEventListener("keydown",(function(t){let n=!1,o=!1;9==t.which||(2==constants.layer?(e(),9==t.which||(39==t.which?(t.preventDefault(),constants.brailleInput.setSelectionRange(positionL1.x,positionL1.x),t.target.selectionStart>t.target.value.length-2?t.preventDefault():(constants.isMac?t.metaKey:t.ctrlKey)?t.shiftKey?(positionL1.x-=1,i("outward_right",positionL1.x,plot.curvePoints.length)):(positionL1.x=plot.curvePoints.length-1,n=!0,o=e()):t.altKey&&t.shiftKey&&positionL1.x!=plot.curvePoints.length-1?(B=positionL1.x,i("inward_right",plot.curvePoints.length,positionL1.x)):(positionL1.x+=1,n=!0,o=e())):37==t.which?(t.preventDefault(),(constants.isMac?t.metaKey:t.ctrlKey)?t.shiftKey?(positionL1.x+=1,i("outward_left",positionL1.x,-1)):(positionL1.x=0,n=!0,o=e()):t.altKey&&t.shiftKey&&0!=positionL1.x?i("inward_left",-1,positionL1.x):(positionL1.x-=1,n=!0,o=e())):t.preventDefault())):t.preventDefault()),constants.brailleInput.addEventListener("focusout",(function(t){display.toggleBrailleMode("off")})),B=positionL1.x,n&&!o&&s(),o&&P.playEnd()}));let U=[constants.svg_container,constants.brailleInput];for(let Y=0;Y<U.length;Y++)U[Y].addEventListener("keydown",(function(t){if(66==t.which&&(display.toggleBrailleMode(),t.preventDefault()),84==t.which){let t=window.performance.now()-N;(!k||t>constants.keypressInterval)&&display.toggleTextMode()}83==t.which&&display.toggleSonificationMode(),34==t.which&&2==constants.layer&&"off"==constants.brailleMode&&(B=positionL1.x,display.toggleLayerMode()),33==t.which&&1==constants.layer&&"off"==constants.brailleMode&&display.toggleLayerMode(),32===t.which&&n()}));function e(){let t=!1;return 1==constants.layer?(position.x<0&&(position.x=0,t=!0),position.x>plot.x.length-1&&(position.x=plot.x.length-1,t=!0)):2==constants.layer&&(positionL1.x<0&&(positionL1.x=0,t=!0),positionL1.x>plot.curvePoints.length-1&&(positionL1.x=plot.curvePoints.length-1,t=!0)),t}function n(){constants.showDisplay&&display.displayValues(plot),constants.showRect&&K.UpdatePointDisplay(),"off"!=constants.sonifMode&&plot.PlayTones(P)}function o(){constants.showDisplayInAutoplay&&display.displayValues(plot),constants.showRect&&(1==constants.layer?K.UpdatePointDisplay():R.UpdatePointDisplay()),"off"!=constants.sonifMode&&plot.PlayTones(P),"off"!=constants.brailleMode&&display.UpdateBraillePos(plot)}function s(){constants.showDisplayInBraille&&display.displayValues(plot),constants.showRect&&R.UpdatePointDisplay(),"off"!=constants.sonifMode&&plot.PlayTones(P),display.UpdateBraillePos(plot)}function i(t,n,s){A=t;let i=1;"outward_left"!=t&&"inward_right"!=t||(i=-1),constants.autoplayId&&constants.KillAutoplay(),constants.isSmoothAutoplay&&P.KillSmooth(),"inward_left"!=t&&"inward_right"!=t||(position.x=n,position.L1x=n),1==constants.layer?constants.autoplayId=setInterval((function(){position.x+=i,position.x<0||position.x>plot.y.length-1?(constants.KillAutoplay(),e()):position.x==s?(constants.KillAutoplay(),o()):o()}),constants.autoPlayRate):2==constants.layer&&(constants.autoplayId=setInterval((function(){positionL1.x+=i,positionL1.x<0||positionL1.x>plot.curvePoints.length-1?(constants.KillAutoplay(),e()):positionL1.x==s?(constants.KillAutoplay(),o()):o()}),constants.autoPlayRate))}function a(t){A=t;let e=[],n=[],o=P.SlideBetween(positionL1.x,0,plot.curvePoints.length-1,-1,1),s=positionL1.x<0?0:positionL1.x,i=0;if("outward_right"==t){for(let t=s;t<plot.curvePoints.length;t++)e.push(P.SlideBetween(plot.curvePoints[t],plot.curveMinY,plot.curveMaxY,constants.MIN_FREQUENCY,constants.MAX_FREQUENCY));n=[o,1],i=Math.abs(plot.curvePoints.length-s)/plot.curvePoints.length*3}else if("outward_left"==t){for(let t=s;t>=0;t--)e.push(P.SlideBetween(plot.curvePoints[t],plot.curveMinY,plot.curveMaxY,constants.MIN_FREQUENCY,constants.MAX_FREQUENCY));n=[o,-1],i=Math.abs(s)/plot.curvePoints.length*3}else if("inward_right"==t){for(let t=plot.curvePoints.length-1;t>=s;t--)e.push(P.SlideBetween(plot.curvePoints[t],plot.curveMinY,plot.curveMaxY,constants.MIN_FREQUENCY,constants.MAX_FREQUENCY));n=[1,o],i=Math.abs(plot.curvePoints.length-s)/plot.curvePoints.length*3}else if("inward_left"==t){for(let t=0;t<=s;t++)e.push(P.SlideBetween(plot.curvePoints[t],plot.curveMinY,plot.curveMaxY,constants.MIN_FREQUENCY,constants.MAX_FREQUENCY));n=[-1,o],i=Math.abs(s)/plot.curvePoints.length*3}constants.isSmoothAutoplay&&P.KillSmooth(),P.playSmooth(e,i,n,constants.vol,"sine")}document.addEventListener("keydown",(function(t){if((constants.isMac?t.metaKey:t.ctrlKey)&&(36==t.which?1==constants.layer?(position.x=0,n(),constants.brailleInput.setSelectionRange(0,0)):2==constants.layer&&(positionL1.x=0,s()):35==t.which&&(1==constants.layer?(position.x=plot.y.length-1,n(),constants.brailleInput.setSelectionRange(plot.curvePoints.length-1,plot.curvePoints.length-1)):2==constants.layer&&(positionL1.x=plot.curvePoints.length-1,s())),t.shiftKey||P.KillSmooth()),k)if(88==t.which){let t=window.performance.now()-N;k&&t<=constants.keypressInterval&&display.displayXLabel(plot),k=!1}else if(89==t.which){let t=window.performance.now()-N;k&&t<=constants.keypressInterval&&display.displayYLabel(plot),k=!1}else if(84==t.which){let t=window.performance.now()-N;k&&t<=constants.keypressInterval&&display.displayTitle(plot),k=!1}else 76==t.which?(N=window.performance.now(),k=!0):k=!1;76==t.which&&(N=window.performance.now(),k=!0),190==t.which&&(constants.SpeedUp(),null!=constants.autoplayId&&(constants.KillAutoplay(),P.KillSmooth(),"inward_left"==A?1==constants.layer?i("outward_right",position.x,C):2==constants.layer&&i("outward_right",positionL1.x,B):"inward_right"==A?1==constants.layer?i("outward_left",position.x,C):2==constants.layer&&i("outward_left",positionL1.x,B):1==constants.layer?i(A,position.x,C):2==constants.layer&&i(A,positionL1.x,B))),188==t.which&&(constants.SpeedDown(),null!=constants.autoplayId&&(constants.KillAutoplay(),P.KillSmooth(),"inward_left"==A?1==constants.layer?i("outward_right",position.x,C):2==constants.layer&&i("outward_right",positionL1.x,B):"inward_right"==A?1==constants.layer?i("outward_left",position.x,C):2==constants.layer&&i("outward_left",positionL1.x,B):1==constants.layer?i(A,position.x,C):2==constants.layer&&i(A,positionL1.x,B)))}))}"on"==constants.brailleMode&&display.toggleBrailleMode("on")}));